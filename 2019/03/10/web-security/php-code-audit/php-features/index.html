<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>php语言特性类型讲解 | greetdawn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="article">
<meta property="og:title" content="php语言特性类型讲解">
<meta property="og:url" content="http://www.greetdawn.top/2019/03/10/web-security/php-code-audit/php-features/index.html">
<meta property="og:site_name" content="greetdawn&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/aaa.jpg">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201224152749.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225091551.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225150821.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225155527.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225164056.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201228135450.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20201228140800.png">
<meta property="article:published_time" content="2019-03-10T01:19:57.000Z">
<meta property="article:modified_time" content="2021-01-29T08:04:16.200Z">
<meta property="article:author" content="丨greetdawn丨">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="PHP语言特性">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/aaa.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="greetdawn's Blog" type="application/atom+xml">
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">greetdawn's Blog</div>
      
        <div id="subtitle">The God love people</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">greetdawn&#39;s Blog</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="www.greetdawn.top">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-web-security/php-code-audit/php-features" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/10/web-security/php-code-audit/php-features/" class="article-date">
  <time datetime="2019-03-10T01:19:57.000Z" itemprop="datePublished">2019-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">PHP代码审计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      php语言特性类型讲解
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/aaa.jpg"></p>
<span id="more"></span>

<h1 id="PHP语言特性"><a href="#PHP语言特性" class="headerlink" title="PHP语言特性"></a>PHP语言特性</h1><h2 id="extract变量覆盖"><a href="#extract变量覆盖" class="headerlink" title="extract变量覆盖"></a>extract变量覆盖</h2><h3 id="漏洞源码"><a href="#漏洞源码" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'cimer'</span><span class="token punctuation">;</span> 
<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$shiyan</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span> 
    <span class="token variable">$content</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$shiyan</span><span class="token operator">==</span><span class="token variable">$content</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span> 
        <span class="token keyword">echo</span><span class="token string single-quoted-string">'ctf&#123;cimer_2021_come_on&#125;'</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span>
   <span class="token keyword">else</span>
   <span class="token punctuation">&#123;</span> 
    <span class="token keyword">echo</span><span class="token string single-quoted-string">'Oh.no'</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>extract()</code>函数</p>
<ul>
<li><p>从数组中将变量导入到当前的符号表</p>
</li>
<li><p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量</p>
</li>
<li><p>语法：extract(array,extract_rules,prefix)</p>
</li>
<li><p>array,必需，要使用的数组</p>
</li>
</ul>
<p>GET传参或者POST传参时，带入到extact函数中，直接传入同名变量名，即可覆盖原有变量值。</p>
<p>flag变量值为cimer</p>
<p>extract()通过GET方式接受一个数组，键名作为变量名，值为变量值</p>
<p>如果变量$shiyan为空，则$flag值通过file_get_contents()赋值给变量$content</p>
<p>如果变量$shiyan与$content值相同，则输出flag</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload构造<code>index.php?shiyan=&amp;flag=</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201224152749.png"></p>
<h2 id="绕过过滤的空白字符"><a href="#绕过过滤的空白字符" class="headerlink" title="绕过过滤的空白字符"></a>绕过过滤的空白字符</h2><h3 id="漏洞源码-1"><a href="#漏洞源码-1" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span> 
<span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> 
<span class="token variable">$req</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_error"</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hint:26966dc52e85af40f59b4fe73d8c323a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"have a fun!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$_GET</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$global_var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$global_var</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$req</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span> 
 
<span class="token keyword">function</span> <span class="token function-definition function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$j</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span> 
        <span class="token punctuation">&#125;</span> 
        <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span> 
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$info</span><span class="token operator">=</span><span class="token string double-quoted-string">"sorry, you cann't input a number!"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
     <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"number must be equal to it's integer!! "</span><span class="token punctuation">;</span>  
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
     <span class="token variable">$value1</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token variable">$value2</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value1</span><span class="token operator">!=</span><span class="token variable">$value2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
          <span class="token variable">$info</span><span class="token operator">=</span><span class="token string double-quoted-string">"no, this is not a palindrome number!"</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span>
     <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
              <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"nice! <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$value1</span><span class="token punctuation">&#125;</span></span> is a palindrome number!"</span><span class="token punctuation">;</span> 
     <span class="token punctuation">&#125;</span>
          <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
             <span class="token variable">$info</span><span class="token operator">=</span><span class="token variable">$flag</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span> 
<span class="token keyword">echo</span> <span class="token variable">$info</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>函数分析</p>
<ul>
<li>trim — 去除字符串首尾处的空白字符（或者其他字符）</li>
<li>is_string — 检测变量是否是字符串，addslashes — 使用反斜线引用字符串</li>
<li>strval — 获取变量的字符串值</li>
<li>strlen — 获取字符串长度</li>
<li>is_numeric — 检测变量是否为数字或数字字符串 </li>
<li>intval — 获取变量的整数值</li>
<li>is_palindrome_number —— 自定义函数判断数字是否为非回文数</li>
</ul>
<p>逻辑分析</p>
<p>number为get接受参数变量；</p>
<p>第一个判断如果变量number为空值，则设置header有hint字段，并die出一句话;</p>
<p>条件一：<code>if(is_numeric($_REQUEST[&#39;number&#39;]))</code> 检测变量是否为数字或者数字字符串，条件是false；</p>
<p>条件二：<code>elseif($req[&#39;number&#39;]!=strval(intval($req[&#39;number&#39;])))</code>检测变量是否为回文数；</p>
<p>条件三：<code>if(is_palindrome_number($req[&quot;number&quot;]))</code>调用函数<code>is_palindrome_number</code>判断当前数字为非回文数</p>
<p>绕过条件一的方式是：%00为空字符，不会影响后面的数值；</p>
<p>咋眼一看条件二和条件三是冲突的，这边我们必须想法子绕过；为了同时满足条件二和绕过函数<code>is_palindrome_number</code>。可以对源代码进行相关简化，得到如下简化代码：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//strval — 获取变量的字符串值</span>
    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//strlen — 获取字符串长度</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$j</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">==</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token operator">!</span><span class="token function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span>
</code></pre>

<p>fuzzing代码如下：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python2</span>
<span class="token comment">#conding:utf-8</span>

<span class="token keyword">import</span> requests
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	rq <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://192.168.1.191:32776/stage/2/index2.php?number=%s191"</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token string">"%%%02X"</span><span class="token operator">%</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">#print(rq.text)</span>
	<span class="token keyword">if</span> <span class="token string">'1'</span> <span class="token keyword">in</span> rq<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token string">"%%%02X"</span><span class="token operator">%</span>i
      
output<span class="token punctuation">:</span>
    <span class="token operator">%</span>0C
	<span class="token operator">%</span>2B</code></pre>



<h3 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:<code>http://192.168.1.191:32776/stage/2/index2.php?number=%00%0C191</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225091551.png"></p>
<h2 id="ereg正则绕过"><a href="#ereg正则绕过" class="headerlink" title="ereg正则绕过"></a>ereg正则绕过</h2><h3 id="漏洞源码-2"><a href="#漏洞源码-2" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 

<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z0-9]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>You password must be alphanumeric&lt;/p>'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">9999999</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'*-*'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> 
      <span class="token punctuation">&#123;</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span> <span class="token operator">.</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;p>*-* have not been found&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span> 
     <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Invalid password&lt;/p>'</span><span class="token punctuation">;</span> 
      <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span> 
<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-2"><a href="#漏洞分析-2" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>ereg函数:函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。此函数存在%00截断问题，只要遇到%00就停止匹配。</p>
<p>条件一：首先erge正则匹配使得变量password必须满足数字字母组成；</p>
<p>条件二：限制password长度必须小于8，并且值要大于9999999；</p>
<p>条件三：密码中必须要含有字符*-*;</p>
<h3 id="漏洞利用-2"><a href="#漏洞利用-2" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>绕过条件一使用%00截断；</p>
<p>绕过条件而使用科学计数法1e9;</p>
<p>满足条件三%00后面拼接*-*;</p>
<p>payload:?password=1e9%00*-*</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225150821.png"></p>
<h2 id="strcmp比较字符串"><a href="#strcmp比较字符串" class="headerlink" title="strcmp比较字符串"></a>strcmp比较字符串</h2><h3 id="漏洞源码-3"><a href="#漏洞源码-3" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">else</span>  
        <span class="token keyword">print</span> <span class="token string single-quoted-string">'No'</span><span class="token punctuation">;</span>  
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-3"><a href="#漏洞分析-3" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>strcmp()</p>
<p>这个函数用于字符串比较</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">int</span> <span class="token function">strcmp</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$str1</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$str2</span> <span class="token punctuation">)</span>
<span class="token comment">// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 > 0；如果两者相等，返回 0。</span></code></pre>

<p>可知，传入的期望类型是字符串类型的数据，但是如果我们传入非字符串类型的数据的时候，这个函数将会有怎么样的行为呢？实际上，当这个函数接受到了不符合的类型，这个函数将发生错误，但是在<code>5.3</code>之前的php中，显示了报错的警告信息后，将<code>return 0</code> !!!! 也就是虽然报了错，但却判定其相等了。这对于使用这个函数来做选择语句中的判断的代码来说简直是一个致命的漏洞，当然，php官方在后面的版本中修复了这个漏洞，使得报错的时候函数不返回任何值。<code>strcmp</code>只会处理字符串参数，如果给个数组的话呢，就会返回<code>NULL</code>,而判断使用的是<code>==</code>，<code>NULL==0</code>是 <code>bool(true)</code></p>
<h3 id="漏洞利用-3"><a href="#漏洞利用-3" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:?a[]=1</p>
<h2 id="sha-函数比较绕过"><a href="#sha-函数比较绕过" class="headerlink" title="sha()函数比较绕过"></a>sha()函数比较绕过</h2><h3 id="漏洞源码-4"><a href="#漏洞源码-4" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Your password can not be your name!&lt;/p>'</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Invalid password.&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Login first!&lt;/p>'</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-4"><a href="#漏洞分析-4" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>sha1()函数计算字符串sha-1散列，接受参数位字符串类型</p>
<p>=== 为恒等式会对变量类型进行比较</p>
<p>若传入变量为数组类型，就会使sha1函数返回错误，即false；都报错的情况下， 恒等式即成立</p>
<h3 id="漏洞利用-4"><a href="#漏洞利用-4" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:?name[]=1&amp;passwordp[]=2</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225155527.png"></p>
<h2 id="session验证绕过"><a href="#session验证绕过" class="headerlink" title="session验证绕过"></a>session验证绕过</h2><h3 id="漏洞源码-5"><a href="#漏洞源码-5" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">die</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">print</span> <span class="token string single-quoted-string">'&lt;p>Wrong guess.&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-5"><a href="#漏洞分析-5" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>若session里的password的值和get传参进去的值相等，则会输出flag；</p>
<p>对其$_SESSION[‘password’]进行输出发现结果为null，所以这里构造password传入空值，使其相等；</p>
<h3 id="漏洞利用-5"><a href="#漏洞利用-5" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:?password=</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201225164056.png"></p>
<h2 id="md5比较绕过"><a href="#md5比较绕过" class="headerlink" title="md5比较绕过"></a>md5比较绕过</h2><h3 id="漏洞源码-6"><a href="#漏洞源码-6" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"md5bypass"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Could not select database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connection failed: "</span> <span class="token operator">.</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> 
	<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select pw from php where user='<span class="token interpolation"><span class="token variable">$user</span></span>'"</span><span class="token punctuation">;</span>
	<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token constant">MYSQL_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span>pw<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">[</span>pw<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Logged in!"</span> <span class="token operator">.</span> <span class="token variable">$flag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;p>Log in failure!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-6"><a href="#漏洞分析-6" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>strcasecmp(string1, string2) 函数比较两个字符串。如果相等返回0，如果string1&lt;string2返回&lt;0,如果string1&gt;string2返回&gt;0</p>
<p>提示：strcasecmp() 函数是二进制安全的，且不区分大小写。</p>
<p>根据代码只要让$row[pw]与变量$pass相等即可输出flag；</p>
<p>$pass是经过md5之后的值，这个值用户可以通过输入控制；</p>
<p>$row[pw]的值是通过sql查询获取到；</p>
<p>通过代码很明显可以看出来，在user变量处没有任何过滤存在，是明显存在注入的；</p>
<p>通过注入构造控制$row[pw]为用户自己输入的md5值即可，pass的值可控，直接输入对应md5的明文即可；</p>
<h3 id="漏洞利用-6"><a href="#漏洞利用-6" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:<code>admin&#39; AND 0=1 union select &#39;202cb962ac59075b964b07152d234b70&#39;#</code>&amp;pass=123</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201228135450.png"></p>
<h2 id="md5加密相等绕过"><a href="#md5加密相等绕过" class="headerlink" title="md5加密相等绕过"></a>md5加密相等绕过</h2><h3 id="漏洞源码-7"><a href="#漏洞源码-7" class="headerlink" title="漏洞源码"></a>漏洞源码</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$md51</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'QNKCDZO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$md52</span> <span class="token operator">=</span> @<span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'QNKCDZO'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$md51</span> <span class="token operator">==</span> <span class="token variable">$md52</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag:"</span> <span class="token operator">.</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"false!!!"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"please input a"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>



<h3 id="漏洞分析-7"><a href="#漏洞分析-7" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>php中md5值若是0e开头，那么与其他的0e开头的md5值相等，这也成为md5碰撞</p>
<pre class="language-none"><code class="language-none">s878926199a
0e545993274517709034328855841020
s155964671a
0e342768416822451524974117254469
s214587387a
0e848240448830537924465865611904
s214587387a
0e848240448830537924465865611904
s878926199a
0e545993274517709034328855841020
s1091221200a
0e940624217856561557816327384675
s1885207154a
0e509367213418206700842008763514
s1502113478a
0e861580163291561247404381396064
s1885207154a
0e509367213418206700842008763514
s1836677006a
0e481036490867661113260034900752
s155964671a
0e342768416822451524974117254469
s1184209335a
0e072485820392773389523109082030
s1665632922a
0e731198061491163073197128363787
s1502113478a
0e861580163291561247404381396064
s1836677006a
0e481036490867661113260034900752
s1091221200a
0e940624217856561557816327384675
s155964671a
0e342768416822451524974117254469
s1502113478a
0e861580163291561247404381396064
s155964671a
0e342768416822451524974117254469
s1665632922a
0e731198061491163073197128363787
s155964671a
0e342768416822451524974117254469
s1091221200a
0e940624217856561557816327384675
s1836677006a
0e481036490867661113260034900752
s1885207154a
0e509367213418206700842008763514
s532378020a
0e220463095855511507588041205815
s878926199a
0e545993274517709034328855841020
s1091221200a
0e940624217856561557816327384675
s214587387a
0e848240448830537924465865611904
s1502113478a
0e861580163291561247404381396064
s1091221200a
0e940624217856561557816327384675
s1665632922a
0e731198061491163073197128363787
s1885207154a
0e509367213418206700842008763514
s1836677006a
0e481036490867661113260034900752
s1665632922a
0e731198061491163073197128363787
s878926199a
所以随便挑一个0e开头的md5对应的原码 构造 playload即可</code></pre>



<h3 id="漏洞利用-7"><a href="#漏洞利用-7" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>payload:?a=s878926199a</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20201228140800.png"></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.greetdawn.top/2019/03/10/web-security/php-code-audit/php-features/" data-id="ckzqi7ikt003iioumghms5s9w" class="article-share-link">分享到</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7/" rel="tag">PHP语言特性</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/05/14/web-security/php-code-audit/php-unserialize-vul/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          php反序列化漏洞解析
        
      </div>
    </a>
  
  
    <a href="/2019/03/07/web-security/php-code-audit/php-audit-thinkphp5-readfile/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">thinkphp5文件包含漏洞分析</div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 丨greetdawn丨<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>